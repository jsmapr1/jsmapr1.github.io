
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>The Art of Working With Code(rs)  | Dev</title>

<meta name="author" content="Joe"> 

<meta name="description" content="I recently wrote about how to use json-server to mock api calls when writing web apps.
And that is very useful when you want write code and not have &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Dev" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Dev</a></h1>
<h4>The Art of Working With Code(rs)</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thejoemorgan.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/18/testing-apis-with-nock/">
		
			Testing Apis With Nock</a>
	</h2>
	<div class="entry-content">
		<p>I <a href="/blog/2016/04/07/mocking-apis-locally-with-webpack-dot-environmentplugin-and-json-server/">recently wrote</a> about how to use json-server to mock api calls when writing web apps.
And that is very useful when you want write code and not have to worry about latency or api limits.
However, it is still an extra dependency and may not make sense in all projects.</p>

<p>Testing needs to be self contained and have minimal external dependencies (for now, I will just talk about unit testing).
In addition, I want to be able to test things that may have a security component that I do not want publicly exposed (an api key, for example).
Allowing mocking in tests prevents them from exposing secure information while still ensuring that all the code is tested (that&rsquo;s the goal at least).
For this reason, I have taken a liking to <a href="https://github.com/node-nock/nock">nock</a> for mocking out expected api calls.
I&rsquo;ve recently been using it heavily as I build an <a href="https://github.com/jsmapr1/frontend-gitlab/">api wrapper library</a> and I become more impressed with the project each time I use it.</p>

<h2>Basic Example</h2>

<p>What makes nock so great is its simplicity.</p>

<p>Here&rsquo;s a very basic example using mocha:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">expect</span> <span class="nx">from</span> <span class="s1">&#39;expect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">nock</span> <span class="nx">from</span> <span class="s1">&#39;nock&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;fetch test&#39;</span><span class="p">,</span> <span class="p">()</span><span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">nock</span><span class="p">(</span><span class="s1">&#39;http://foo.com&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/events&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span> <span class="nx">events</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="p">})</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">after</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">nock</span><span class="p">.</span><span class="nx">cleanAll</span><span class="p">()</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should get events&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://foo.com/api/events&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">expect</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">events</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>As with most examples, this is very contrived; it doesn&rsquo;t seem like I&rsquo;m testing much.
Still, it shows the beauty and simplicity of nock.</p>

<p>To break it down:</p>

<ol>
<li><p>We set a url to capture</p></li>
<li><p>We set a REST request on a particular path</p></li>
<li><p>We give a return value</p></li>
</ol>


<p>Each piece is small and clearly defined and allows nice chaining.</p>

<p>The power of nock is that the chaining allows us to add additional elements to our test.</p>

<p>Here&rsquo;s a slightly more complicated example from a <a href="https://github.com/jsmapr1/frontend-gitlab/blob/a704f8f5fc2bc6165811ba31da8fbe401c37fd25/test/requests/issues--test.js">gitlab wrapper package</a> I&rsquo;m writing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">expect</span> <span class="nx">from</span> <span class="s1">&#39;expect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">nock</span> <span class="nx">from</span> <span class="s1">&#39;nock&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">fetch</span> <span class="nx">from</span> <span class="s1">&#39;isomorphic-fetch&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">getIssues</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../src/requests/Issues&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;issues&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">issue</span> <span class="o">=</span>  <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;iid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;project_id&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;state&quot;</span><span class="o">:</span> <span class="s2">&quot;opened&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;created_at&quot;</span><span class="o">:</span> <span class="s2">&quot;2016-05-12T08:16:27.337-05:00&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;updated_at&quot;</span><span class="o">:</span> <span class="s2">&quot;2016-05-12T08:16:27.337-05:00&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;labels&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span class='line'>    <span class="s2">&quot;milestone&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;assignee&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;state&quot;</span><span class="o">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;web_url&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;subscribed&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">nock</span><span class="p">(</span><span class="s1">&#39;http://foo.gitlab.com/api/v3&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">reqheaders</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;PRIVATE-TOKEN&#39;</span><span class="o">:</span> <span class="s1">&#39;abc123&#39;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">persist</span><span class="p">()</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/issues&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">[</span><span class="nx">issue</span><span class="p">])</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">after</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">nock</span><span class="p">.</span><span class="nx">cleanAll</span><span class="p">()</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;will return issues&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">getIssues</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="s1">&#39;http://foo.gitlab.com&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="o">:</span><span class="s1">&#39;abc123&#39;</span><span class="p">})().</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">json</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span><span class="nx">issue</span><span class="p">])</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;can take authentication separate&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">issues</span> <span class="o">=</span> <span class="nx">getIssues</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="s1">&#39;http://foo.gitlab.com&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="o">:</span><span class="s1">&#39;abc123&#39;</span><span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">issues</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">json</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">([</span><span class="nx">issue</span><span class="p">])</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is nearly identical to the first examples with a few differences:</p>

<ol>
<li>I&rsquo;m adding in some request headers. This will ensure that the function I&rsquo;m calling is passed a PRIVATE-TOKEN.</li>
<li>I&rsquo;m calling an additional method <code>persist()</code>. This ensures that the same mock will be avaialable for subsequent tests.
In this case, I want to test a curried and an uncurried version. This allows the same mock to be used for both.</li>
</ol>


<p>The beauty part is that it still retains the simplicity of the first example.
It&rsquo;s short, readable, and most importantly, it just works.</p>

<p>I&rsquo;m just starting to scratch the surface, so be on the lookout for more as I go forward.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-18T09:27:41-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/04/08/that-feeling-of-beautiful-code/">
		
			That Feeling of Beautiful Code</a>
	</h2>
	<div class="entry-content">
		<p>Here&rsquo;s a trivial post, but a great example of why I like writing code.</p>

<p>I consider myself an aesthetic programmer.
I want my code to be visibly appealing and I will sometimes write code in a certain way just because I think it looks better.</p>

<p>Every now and then I write something and I enjoy what I&rsquo;ve written so much that I just sit and savor the moment.
Here&rsquo;s what brought on that feeling today.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">TagReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">todo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">todos</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">todo</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">[...</span><span class="nx">todos</span><span class="p">,</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">tag</span><span class="p">]</span> <span class="o">:</span> <span class="nx">todos</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s merely a simple method to reduce an array of objects down to an array of the unique values of one of the object properties.
There is nothing exciting. I&rsquo;m sure I&rsquo;ve written it before.</p>

<p>And to get to that point, I started with a simple test. And let it run below my text editor while I worked out the details.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;creates an array of tags&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">events</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;foo-1&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;foo-2&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;bar-1&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'>  <span class="nx">expect</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">TagReducer</span><span class="p">,[])).</span><span class="nx">toEqual</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>I just loved that reducer function.
It&rsquo;s simple, yet elegant. Just like Audrey Hepburn.</p>

<p>What made it even more satisfying is that several years ago I would&rsquo;ve written something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">getTags</span><span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">events</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">events</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;tag&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">res</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">events</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="s1">&#39;tag&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There would have been, of course, no test.
I would&rsquo;ve refreshed the browser a dozen times and had to look up the index function.
And the best part is, I would&rsquo;ve congratulated myself for writing a function that has a single responsibility with a clear name.
I probably would&rsquo;ve sat back and enjoyed the same feeling I enjoy now.</p>

<p>The code works perfectly well. There&rsquo;s no particular reason to be hard on it, but it just doesn&rsquo;t feel as good now.
Part of the elegance in the new code is thanks to the improvements of  javascript with es6.
However, part of it is just that I put more focus on the craftsmanship.</p>

<p>The beauty part of writing code, is that there is both the satisfying pursuit of craftsmanship along with the intellectual challenge of solving problems and the boundless opportunities to learn new paradigms, languages, patterns, frameworks, and so on.
It&rsquo;s a journey. And like most journey, it can either be miserable, if one feels rushed, or
it can be deeply meaningful if we can take a moment to appreciate the process.</p>

<p>Coding is great.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-04-08T16:08:19-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/personal/'>personal</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/04/07/mocking-apis-locally-with-webpack-dot-environmentplugin-and-json-server/">
		
			Mocking Apis Locally With Webpack and Json-server</a>
	</h2>
	<div class="entry-content">
		<p>I always love the beginning of a new project.
It&rsquo;s a great time to rethink a few basic fundamentals and to improve the overall development experience.</p>

<p>On my most recent project, I decided to give webpack a try.
I&rsquo;ve thought about using webpack before, but never pulled the trigger until one blogger deemed it the &lsquo;winner&rsquo; of <a href="https://medium.com/javascript-and-opinions/state-of-the-art-javascript-in-2016-ab67fc68eb0b#.qv9ei0f00">dependency management</a>
I decided. Why not. Let&rsquo;s give it a go.</p>

<p>I&rsquo;m not fully converted quite yet, but I did run into an interesting use case today.
I&rsquo;m building a single page app that will serve as an events page for a week long event. It will be similar to a conference page.</p>

<p>I&rsquo;ll be pulling in a list of events from an api on the base site and then I&rsquo;ll handle filtering, saving, sharing, and all that fun stuff with React.</p>

<p>So far, so normal. The trick is that the api will ultimately be on the same domain as the single page app, but for development purposes, I&rsquo;m keeping them separate (mostly so the full app can be in a separate git repo, but other reasons as well).
Now I have a problem dealing with <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">cross-origin resource sharing</a>.
The code I&rsquo;m working on is on localhost and the api is on the test site for the original site (for purposes of this post, we&rsquo;ll call it foo.app).</p>

<p>I thought about just modifying the headers on foo.app locally, but I want to allow other devs to contribute and everyone has slightly different development set ups (a problem for another day).
Out the window goes that idea.</p>

<p>The problem came to this: How can I make an api server that I can include with the project? And how can I configure the project to use that during development and the actual server in production?</p>

<h2>A simple local server</h2>

<p>The answer to the api server was ridiculously simple thanks to a great project called <a href="https://github.com/typicode/json-server">json-server</a>.</p>

<p>The project is hosted on npm, so a simple install pulled it into my codebase <code>npm install --save-dev json-server</code>.
The official documentation suggests installing it globally, but I wasn&rsquo;t interested in that. I wanted the project to be dead simple for other developers to jump into, so I added a simple start up script to my package.json.
Make note of the start script, we&rsquo;ll come back to that in a bit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;webpack-dev-server --output-public-path=/public/&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;api&quot;</span><span class="o">:</span> <span class="s2">&quot;json-server --watch db.json --port 3004&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After the project is cloned and dependencies installed, future devs just have to run <code>npm run api</code> to get the api server up and running.</p>

<p>The second step is to create a db.json file to serve as the mock data.
My api endpoint will be <strong>foo.app/foo-fest</strong> and I want an array of events, so the db.json file will looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;foo-fest&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>       <span class="s2">&quot;events&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Cool Title&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;So Cool&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;event&quot;</span><span class="o">:</span> <span class="s2">&quot;Saturday, April 9, 2016, 12 - 1pm&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;tags&quot;</span><span class="o">:</span> <span class="s2">&quot;cool&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Awesom Title&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;So Awesome&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;event&quot;</span><span class="o">:</span> <span class="s2">&quot;Sunday, April 10, 2016, 12 - 1pm&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;tags&quot;</span><span class="o">:</span> <span class="s2">&quot;awesome&quot;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, with the server running, a visit to <strong>localhost:3004/foo-fest</strong> will return an object containing &ldquo;events&rdquo; and the array.</p>

<p>Phase one, check.</p>

<h2>Configure API url by environment</h2>

<p>With phase one under control, the next step is to query the correct api depending on the environment. This is where webpack enters the picture.</p>

<p>I wanted to be able to use the build in webpack server for development, but needed to pass the environment variable.</p>

<p>Previously, the suggestions was to use <a href="https://twitter.com/dan_abramov/status/592692202335301636">DefinePlugin</a> to set the NODE_ENV.
However, that lead to some rather <a href="http://stackoverflow.com/a/31517695">clunky code</a> to allow different variables to be passed.</p>

<p>Fortunately, as was noted later in the Stack Overflow post, webpack introduced a new way to define environment variables called
<a href="https://github.com/webpack/docs/wiki/list-of-plugins#environmentplugin">EnvironmentPlugin</a>.
There are some security benefits, but the main advantage was it cleans everything up.</p>

<p>Here&rsquo;s my webpack.config with an EnvironmentVariable:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>  <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">EnvironmentPlugin</span><span class="p">([</span>
</span><span class='line'>      <span class="s1">&#39;NODE_ENV&#39;</span>
</span><span class='line'>  <span class="p">])</span>
</span><span class='line'><span class="p">],</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this in place, I can pass the NODE_ENV variable through webpack and into the application.</p>

<p>The next step is to add an config that holds the url for the api by environment.
The config is very basic. I may use it in the future. I may not. For now here, it is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;production&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;api&quot;</span> <span class="o">:</span> <span class="s2">&quot;http://foo.app&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="s2">&quot;dev&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;api&quot;</span><span class="o">:</span> <span class="s2">&quot;http://localhost:3004&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m use redux to handle state and dispatching of actions. So, I&rsquo;ve modified my fetch method to accept a url:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchEvents</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">json</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">dispatch</span><span class="p">(</span><span class="nx">receiveEvents</span><span class="p">(</span><span class="nx">json</span><span class="p">));</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In my application code, I choose the correct url using the environment variable.
Then I pass it to my dispatch method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">configureStore</span> <span class="nx">from</span> <span class="s1">&#39;./redux/configureStore&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">config</span> <span class="nx">from</span> <span class="s1">&#39;./config&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">config</span><span class="p">[</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">].</span><span class="nx">api</span> <span class="o">+</span> <span class="s1">&#39;/foo-fest&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">configureStore</span><span class="p">();</span>
</span><span class='line'><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchEvents</span><span class="p">(</span><span class="nx">url</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, I update my package.json to run the webpack server with dev as the environment:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;NODE_ENV=dev webpack-dev-server --output-public-path=/public/&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;api&quot;</span><span class="o">:</span> <span class="s2">&quot;json-server --watch db.json --port 3004&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Wrapping Up</h2>

<p>At this point, future developers can just clone the repo and run a few npm scripts to get a working api endpoint.
The clear downside is that since this is not the same as the production api, there is a potential for bugs if the endpoint changes.
In general, I try to avoid premature optimization and this is a clear problem while the api changes are less pressing.
Besides, if the api changes, I just need to update the db.json to reflect the new data structure and I can keep on trucking.</p>

<p>Other benefits to this approach include speed (less latency) and not having to worry about api limits (less of an issue for this particular project, but still worth considering).</p>

<p>I may not be fully bought into Webpack just yet, but this certainly helps.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-04-07T16:00:37-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/03/25/testing-redux-reducers/">
		
			Testing Redux Combined Reducers</a>
	</h2>
	<div class="entry-content">
		<p>I have a few problems recently testing Redux reducers.
The <a href="http://redux.js.org/docs/recipes/WritingTests.html">documentation</a> is helpful but doesn&rsquo;t match the rest of the tutorial.</p>

<h2>Simple Test</h2>

<p>Consider a basic reducer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">tagFilter</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;TAG_FILTER&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">.</span><span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The test for this is very simple. Call the function. Pass a state and an action. Expect the result:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">expect</span> <span class="nx">from</span> <span class="s1">&#39;expect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">tagFilter</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../js/redux/reducers&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;reducer tests&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle tagFilter&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">tag</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">tagFilter</span><span class="p">([],</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>      <span class="p">[</span><span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">tagFilter</span><span class="p">([</span><span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>          <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is all very simple and explained in the official documentation.</p>

<p>The problem is that this test does not conform to the rest of the documentation.</p>

<h2>Larger Test</h2>

<p>The documentation spends a lot of time talking about <a href="http://redux.js.org/docs/basics/Reducers.html#splitting-reducers">splitting reducers</a> and then combining them into a single reducer.</p>

<p>We now have a test for each split reducer, but we do not have a way to test the combined reducer. In a way, this is better cause it keeps are tests minimal and isolated, but looking at how we can test a combined reducer will help us to better understand the state object.</p>

<p>Here&rsquo;s a slightly larger set of reducers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="p">{</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">tagFilter</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;TAG_FILTER&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">.</span><span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kd">function</span> <span class="nx">savedItems</span><span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;SAVE_ITEM&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;REMOVE_ITEM&#39;</span><span class="o">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">[</span>
</span><span class='line'>          <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">state</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">)),</span>
</span><span class='line'>          <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">tagFilter</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">savedItems</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that I am exporting each individual reducer as well as the combined reducer.</p>

<p>If I wanted to test individual reducers, I would proceed as above. If I wanted to test a reducer in the context of a combined reducer,
I would need to slightly change my expectations.</p>

<p>The combined reducer returns an object that consists of the name of the reducer and the state. So my combined reducer would return this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nx">tagFilter</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>    <span class="nx">savedItems</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If I wanted to test the <code>tagFilter</code>, my expect would either have to account for the base and update the object or it would have to pull the correct state from the combined reducer. Here is an example of the first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">expect</span> <span class="nx">from</span> <span class="s1">&#39;expect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">tagFilter</span><span class="p">,</span> <span class="nx">savedItems</span><span class="p">,</span> <span class="nx">app</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../js/redux/reducer&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">actions</span> <span class="nx">from</span> <span class="s1">&#39;../../js/redux/actions&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;reducer tests&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">base</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">tagFilter</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>    <span class="nx">savedItems</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle tagFilter&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">tag</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">app</span><span class="p">([],</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>      <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">base</span><span class="p">,</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;tagFilter&#39;</span><span class="o">:</span> <span class="p">[</span><span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">app</span><span class="p">(</span>
</span><span class='line'>        <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">base</span><span class="p">,</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s1">&#39;tagFilter&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">),</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>      <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">base</span><span class="p">,</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;tagFilter&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here is an example of the second:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">expect</span> <span class="nx">from</span> <span class="s1">&#39;expect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="p">{</span><span class="nx">app</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../../js/redux/reducer&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">actions</span> <span class="nx">from</span> <span class="s1">&#39;../../js/redux/actions&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;reducer tests&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle tagFilter&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">tag</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kr">const</span> <span class="nx">base</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">tagFilter</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>      <span class="nx">savedItems</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>        <span class="nx">app</span><span class="p">([],</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">}).</span><span class="nx">tagFilter</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>      <span class="p">[</span><span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">expect</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">app</span><span class="p">(</span>
</span><span class='line'>        <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span>
</span><span class='line'>          <span class="nx">base</span><span class="p">,</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>            <span class="s1">&#39;tagFilter&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">),</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;TAG_FILTER&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">tag</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">).</span><span class="nx">tagFilter</span>
</span><span class='line'>    <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span>
</span><span class='line'>        <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="p">]</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice how I still need to include the base object in the second part of the test so that I can set an initial state.
It&rsquo;s not strictly necessary for the first part of the test where we are starting with an empty state, but it is necessary for the second part where we are appending state.</p>

<p>Testing <code>savedItems</code> is roughly the same idea.
It&rsquo;s probably best to keep tests minimal and to test each reducer in isolation from the combined reducer, however, that is not the only approach.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-03-25T14:52:51-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javscript/'>javscript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/03/08/ways-coders-lead/">
		
			Ways Coders Lead</a>
	</h2>
	<div class="entry-content">
		<p>I spend a lot of time thinking about how people lead.
And when I say that, I don&rsquo;t mean how people manage.
I want to know how effective people make things happen.
Sometimes they are also managers. Sometimes they are not.</p>

<p>Of course, I&rsquo;m not the only one, there has been an ocean of ink spilled on the topic.
There is less, though, specifically about ways that coders can lead.</p>

<p>Every job and every career has its own unique challenges, but I&rsquo;ve rarely seen a field where there is such a breadth of leadership options as there is in coding.</p>

<p>As I thought about some of the people I&rsquo;ve worked with in the past, I realized that there are lots of different ways to be effective.
And, perhaps more interesting still, it is nearly impossible to find someone that is effective in all ways even as it is certainly the case that some individuals can lead in more than one way.</p>

<p>The crucial point is that there can be many leaders. And not all of them will receive an official job title that designates them as such.
That&rsquo;s a good thing.
It&rsquo;s important nonetheless to recognize the value of each type.</p>

<p>Here, then, is a brief sketch of different type of ways leadership can manifest itself in coders.</p>

<h2>Technical Leader</h2>

<p>This is an easy example.
A technical leader is often the smartest person in the room (code-wise).
They know a thousand different patterns and paradigms.
It seems as if they&rsquo;ve memorized all the man pages, seeming to pull out flags and options that no one knew existed.</p>

<p>The trick with technical leaders, is that they should be spending time with technical decisions.
A common mistake is to move them into human leadership roles because they are good at technical things.</p>

<p>This makes no sense.</p>

<p>Now there are technical leaders that are also good in other realms and if they want to manage humans and interactions, awesome.
For many, perhaps most, technical leaders, they should spend time making technical decisions.</p>

<p>In coding, at least, we have ways to recognize these individuals.
There are programmers and senior programmers and architects and, why not, senior architects.
This is great. Let them build amazing things. Let someone else send emails.</p>

<h2>Diplomat</h2>

<p>The diplomat is a coder that can communicate.
Not only do they work well with other departments (sales, design, management, etc.), people in those departments <em>like</em> talking to the coder.</p>

<p>Diplomats represent a unique subset of the coder world were everyone is assumed to be pale introverts.
Without them, an engineering team would have a hard time functioning.
This doesn&rsquo;t mean that coders shouldn&rsquo;t interact with groups outside their tribe if they aren&rsquo;t diplomats; everyone should be able to communicate.
This just means that diplomats do it very well.</p>

<p>Diplomats are great people to send to meetings because not only are they good at representing their teammates, they actively enjoy learning about other groups and how they are contributing to the project.
In other words, don&rsquo;t make the mistake of sending only technical leaders to meetings.
Diplomats, even if they are relatively inexperienced, are made for this environment.</p>

<h2>Energizer</h2>

<p>Another unfortunate and persistent stereotype is that of the coder as sarcastic misanthrope.
Hell, it&rsquo;s even an <a href="http://www.nbc.com/saturday-night-live/video/nick-burns-your-companys-computer-guy/n11524">snl sketch</a>.</p>

<p>But of course, not all developers are like that. Some lift people up, make them excited about whatever is being worked on.
They are the energizers.</p>

<p>Energizers make stand ups fun. They get animated when talking about their project and get excited to hear about everyone else&rsquo;s project.
Most coders start out as energizers and then after implementing the same functionality over and over slowly lose some of their passion.</p>

<p>Energizers don&rsquo;t. Energizers still find joy in whatever they do.
As a result, they are great people to have as mentors for new developers because they never lost that new developer feeling.
They are also great individuals to give talks or lead training because their enthusiasm is infectious so every new concept or technique will be presented with excitement.</p>

<p>They are close to diplomats, but not quite the same. Sometimes their passions are focused just on the technical and so they may not fit well with other departments. They won&rsquo;t be bad, they just won&rsquo;t be quite the same.</p>

<p>Put them in a position where they can make people excited. They will lift everyone&rsquo;s spirit.</p>

<h2>Crisis Manager</h2>

<p>This is pretty obvious. Some people are good in a pinch.
Not only do they stay calm under pressure, they actually get excited by it.
They usually have two abilities:</p>

<p>1) They can quickly diagnose and solve the problem.</p>

<p>2) They keep everyone else calm while they do.</p>

<p>They way they lead is obvious; they are people to go to in times of crisis.
Yet, they shouldn&rsquo;t be limited to the on-call phone.
They are also good people to put in charge of sensitive projects or tight deadlines because they can move quickly and efficiently and they don&rsquo;t get burnt out afterward.</p>

<p>The unexpected realm of leadership is for sensitive projects, think PCI Compliance.
They can be better with these projects because they&rsquo;ve seen a lot of the scenarios before.
They can handle the pressure that comes with high profile projects.
And they spend time thinking about all the individual pieces and how they can go wrong.</p>

<p>It&rsquo;s hard to incorporate coders that are good at crisis management into a workflow.
Crises by definition are unexpected and unplanned. Still, knowing who can handle it when it comes up is helpful.</p>

<h2>Processor</h2>

<p>Processor&rsquo;s are good at strategy. They are curious not just about how the code gets written, but also about the project flow.
This doesn&rsquo;t necessarily mean they only care about applying agile principles or anything like that.
Coders that are good at process may also be good at organizing their own projects so that they consistently hit deadlines.
They may also be better at looking at the overall program flow.
In short, they like looking at the big picture.</p>

<p>Most are immediately recognizable because of their ridiculously complicated dev set up.
They have hundreds of tools with hundreds of customizations and yet they somehow have everything memorized and move with exceptional speed.
They are not just interested in how parts work, but how systems interact.</p>

<p>Since they are so interested in flow and interactions, they usually need some time to, well, process.
They are good people to talk to when something that already exists needs to be analyzed and updated.
They take in the information, synthesize it and can come up with good suggestions.</p>

<p>They can be good at organizing workflow and can see which parts of the system don&rsquo;t return value and where bottlenecks currently exist.
Why are there so many bugs in a certain component? How come there is always a lag after a big project before the next one is underway?
Why do deployments take so long?</p>

<p>The processor may have ideas.</p>

<h2>Everyone&rsquo;s a mix</h2>

<p>These are, I&rsquo;m sure, gross simplifications.
And nearly every developer is a mix of at least two or more of these styles.</p>

<p>The important thing to note is that they are all important to an organization.
So when looking for leadership on coding projects.
Remember, don&rsquo;t always pick the most knowledgeable coder.
Don&rsquo;t pick the one that is most chatty with other departments.
Pick the individual that will have the greatest impact. Give them a chance to use their best abilities.
Everyone will benefit.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-03-08T14:23:58-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/leadership/'>leadership</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/01/05/creating-a-dropdown-menu-in-react/">
		
			Creating a Dropdown Menu in React</a>
	</h2>
	<div class="entry-content">
		<p>Here&rsquo;s a quick guide to creating a dropdown menu with React native components.</p>

<p>Just want code? Here&rsquo;s a demo:</p>

<p data-height="268" data-theme-id="0" data-slug-hash="gPmPyr" data-default-tab="result" data-user="jsmapr1" class='codepen'>See the Pen <a href='http://codepen.io/jsmapr1/pen/gPmPyr/'>React CSSTransitionGroup DropDown Menu</a> by Joe Morgan (<a href='http://codepen.io/jsmapr1'>@jsmapr1</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<p>React provides a simple component for <a href="https://facebook.github.io/react/docs/animation.html">adding animations to items</a>.
It can do a few things, but in short, it works with CSS3 transitions by adding classes for a short amount of time to allow the transition to take affect.</p>

<p>To start, some simple markup:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;menuContainer&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>Body Text<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>Body Text<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>Body Text<span class="nt">&lt;/p&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Obviously, we want the menu to replace the menuContainer element.</p>

<p>Now, we need to create a small menu component.
For simplicity sake, I&rsquo;m leaving state on the component, but I&rsquo;ve since delegated state handling to redux, but the idea is similar:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">let</span> <span class="nx">ReactCSSTransitionGroup</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">addons</span><span class="p">.</span><span class="nx">CSSTransitionGroup</span>
</span><span class='line'>
</span><span class='line'><span class="kr">class</span> <span class="nx">DropDown</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">toggleMenu</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggleMenu</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">menuActive</span><span class="o">:</span> <span class="kc">false</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">toggleMenu</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">menuState</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">menuActive</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">menuActive</span><span class="o">:</span> <span class="nx">menuState</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">menu</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">menuActive</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">menu</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">First</span> <span class="nx">Item</span> <span class="o">&lt;</span><span class="err">/li&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Second</span> <span class="nx">Item</span> <span class="o">&lt;</span><span class="err">/li&gt;</span>
</span><span class='line'>                  <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="nx">Third</span> <span class="nx">Item</span> <span class="o">&lt;</span><span class="err">/li&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="err">/ul&gt;</span>
</span><span class='line'>              <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">menu</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;menu&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">i</span> <span class="nx">className</span> <span class="o">=</span> <span class="s2">&quot;fa fa-plus&quot;</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggleMenu</span> <span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">ReactCSSTransitionGroup</span> <span class="nx">transitionName</span> <span class="o">=</span> <span class="s2">&quot;menu&quot;</span> <span class="nx">transitionEnterTimeout</span><span class="o">=</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span> <span class="nx">transitionLeaveTimeout</span><span class="o">=</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="p">{</span><span class="nx">menu</span><span class="p">}</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/ReactCSSTransitionGroup&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">DropDown</span> <span class="o">/&gt;</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;menuContainer&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok, so what&rsquo;s happening here.
I&rsquo;m creating a simple react element with a state of menuActive.
If we click an icon (I&rsquo;m using <a href="https://fortawesome.github.io/Font-Awesome/">font awesome</a>), then the menuActive state should toggle to true and the menu should animate.
That explains state, the toggleMenu function and the <em>i</em> element.</p>

<p>The trick is the ReactCSSTransitionGroup.
I add the transitionName of menu along with a transitionEnterTimeout and a transitionLeaveTimeout.
This tells react to add the class of menu for 1 second when it adds the new child elements (the menu) and to add it for 1 second when it removes the child elements.
This leaves time for the css transitions to do there thing.</p>

<p>Speaking of, the css is rather simple&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.menu-enter</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">max-height</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transition</span><span class="o">:</span> <span class="k">max-height</span> <span class="m">1s</span> <span class="n">ease</span><span class="p">;</span>
</span><span class='line'>  <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.menu-enter.menu-enter-active</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>  <span class="k">max-height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.menu-leave</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">max-height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
</span><span class='line'>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transition</span><span class="o">:</span> <span class="k">max-height</span> <span class="m">1s</span> <span class="n">ease</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.menu-leave.menu-leave-active</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
</span><span class='line'>  <span class="k">max-height</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">ul</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">border</span><span class="o">:</span> <span class="m">#ababab</span> <span class="k">solid</span> <span class="m">1px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">70%</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we are doing is adding a transition to a max-height of 100px.
Since the menu is dynamically generated, we need max height since I have no idea how big it will be. In production, it will be even larger.</p>

<p>The transitions will take 1 second which is the same as transitionEnterTimeout and transitionLeaveTimeout.</p>

<p>That&rsquo;s pretty much all there is to it. Simple and easy.</p>

<p>The downside is, that CSS3 does not work on ie9 which I do still support, but there are conditional tags for that.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-01-05T08:14:24-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/12/02/building-production-ready-react/">
		
			Building Production Ready React</a>
	</h2>
	<div class="entry-content">
		<h2>Production Ready React</h2>

<p>React is still an evolving project.
Add to that complications of needing to transpile any javascript with ES6 syntax and you have best practices that are, at best, a moving target.
After running into a few issues, I wanted to get all the information I have together in one accessible place.</p>

<p>Here are my goals for the current project:</p>

<ul>
<li>Write code in ES6 syntax (but compiled so that it can be cross-browser compatible)</li>
<li>Make production code as small as possible including all dependencies</li>
<li>Make the project easy to deploy and hand off to other developers</li>
</ul>


<p>This list seemed fairly simple, but there were a few surprises that I did not anticipate.</p>

<h3>ES6 Syntax</h3>

<p>Writing in ES6 (ES2015, whatever) is practically required at this point for a javascript developer.
I, like most, opted for one of the most popular transpilers: <a href="https://babeljs.io/">babel</a>.
This set up is pretty standard (note: I&rsquo;ll be using browserify):</p>

<p><code>npm install --save-dev babelify</code></p>

<p>Most tutorials stop here, but there have been some changes to the project in the last 6 months.
In addition to the base transpiler, we have to install presets so that babelify will work with the various syntax oddities:</p>

<p><code>npm install --save-dev babel-preset-es2015 babel-preset-react</code></p>

<p>One of the big advantages of ES6 and modern javascript development is the ability to create modules so that code can be broken up and included in different files.
The two big contenders for handling this are <a href="http://browserify.org/">browserify</a> and <a href="https://webpack.github.io/">webpack</a>.
Honestly, they seem equally good for me, so I went with browserify for absolutely no specific reason.</p>

<p>Anyway, install that: <code>npm install --save-dev browserify</code>.</p>

<p>After that to build we just need to run:</p>

<p><code>browserify js/app.js -t [ babelify --presets [ es2015 react ] ] &gt; public/js/app.js</code></p>

<p>Again, the secret is to make sure the presets are listed otherwise it won&rsquo;t work and you will receive a very unhelpful error message:</p>

<p><code>ParseError: 'import' and 'export' may appear only with 'sourceType: module'</code></p>

<p>I burned a lot of time trying to figure out what was causing the error.
Turns out it I merely had not included the presets.</p>

<h2>Small Size</h2>

<p>The next step is to pipe everything through <a href="https://github.com/mishoo/UglifyJS2">uglify</a> to get it nice and minimized:</p>

<p><code>npm install --save-dev uglify</code></p>

<p>and then:</p>

<p><code>browserify js/app.js -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js</code></p>

<p>As an example, the first transformation (browserify + babelify) made my code usable in a browser and it weighed in at 950 kb.
Minification made it much smaller at 314 kb. However, that wasn&rsquo;t quite small enough for me.</p>

<p>After looking at the [react documentation] (<a href="https://facebook.github.io/react/downloads.html#npm">https://facebook.github.io/react/downloads.html#npm</a>) I noticed that there was a production and a development mode for React.
The instructions are not very clear on how to achieve production mode, but after a little experimentation, I found the key is to use envify (as suggested in the documentation).</p>

<p><code>npm install --save-dev envify</code></p>

<p>And then add that to the browserify command:</p>

<p><code>browserify js/app.js -g [envify --NODE_ENV 'production'] -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js</code></p>

<p>The <code>-g</code> flag is a global transform that applies to all files after the babelify transforms run. The result is 260 kb file.</p>

<h3>Easy To Give to Other Developers</h3>

<p>To make things even easier, I added that all to my package.json file so that it can be run from the command line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;browserify js/app.js -g [envify --NODE_ENV &#39;production&#39;] -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>This can be run with the command: <code>npm run build</code></p>

<h3>Small Enough?</h3>

<p>The one thing that bothered me, was the code still seemed very large compared to using the official minified version of React.</p>

<p>The minified version of react is only 145 kb and jquery (which I&rsquo;m using mostly for ajax) is only 34 kb. So where does the extra size come from?</p>

<p>As an experiment to get the smallest size, I used <a href="https://github.com/thlorenz/browserify-shim">browserify-shim</a>. This allows me to set global variables so that I can both include them in the script, but not combine the library into the final minified file.</p>

<p>For example, I can begin a script with this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">DropDown</span> <span class="nx">from</span> <span class="s1">&#39;./DropDown.jsx&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">FilterableList</span> <span class="nx">from</span> <span class="s1">&#39;./FilterableList.jsx&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>but browserify-shim knows that React and Jquery will be global variables, so it creates a reference to the global
rather than packaging the React object in the final file.</p>

<p>To make this work, all we need to do is add browserify-shim to our node modules: <code>npm install --save-dev browserify-shim</code>.
And then in our package.json, we update the script to use browserify-shim and we specify which imports should be ignored.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;browserify js/app.js -g [envify --NODE_ENV &#39;production&#39;] -t [ babelify --presets [ es2015 react ] ]  -t browserify-shim | uglifyjs -c -m &gt; public/js/app.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="s2">&quot;browserify-shim&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;react&quot;</span><span class="o">:</span> <span class="s2">&quot;global:React&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;react-dom&quot;</span><span class="o">:</span> <span class="s2">&quot;global:ReactDOM&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;jquery&quot;</span><span class="o">:</span> <span class="s2">&quot;global:$&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And, of course, now the minified versions must be included in the page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://fb.me/react-with-addons-0.14.5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://fb.me/react-dom-0.14.5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;public/js/app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The final result is a combined total of 195 kb. Why it gets so much smaller, I&rsquo;m not quite sure.
Honestly, I still haven&rsquo;t decided if the extra size is worth the latency of fetching that many more files, but a drop of over 33% is nothing to walk away from.
For now, I like having the option. Some throttled and mobile testing later will help decide if it is worth it.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-12-02T16:28:24-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/11/17/why-i-love-micro-training/">
		
			Why I Love Microtraining</a>
	</h2>
	<div class="entry-content">
		<p>Training is important. Nearly every job, nearly every department, nearly every company will at least tacitly acknowledge importance of training.</p>

<p>However, the effectiveness training when it is implemented is limited. Why?
Because nearly always, the training involves long periods in a room with someone yammering on for at least an hour (and often much, much longer).
The ideas are useful but often too abstract for any attendants particular needs.</p>

<p>They are engaged in what I&rsquo;ll call &lsquo;macrotraining&rsquo;.</p>

<p>Macrotraining means big ideas, a sage on the stage, calendar events with reminders.
Don&rsquo;t get me wrong, those things have a place.
Yet, the places where I&rsquo;ve had the most growth didn&rsquo;t have very many of these trainings.
Instead, learning was embedded in daily work and occurred spontaneously.
It was certainly still a form of training, but it&rsquo;s what I would call &lsquo;Microtraining&rsquo;.</p>

<h2>Macrotraining vs Microtraining</h2>

<p>Macrotraining is what most people think of when they think of training.
Here are some of the traits:</p>

<ul>
<li><strong>Scheduled</strong>: It happens at specific times that everyone dutifully marks on their calendar,</li>
<li><strong>Explicit Instructor/Student Roles</strong>: Someone is imparting knowledge either by lecturing or leading hands on exercises,</li>
<li><strong>Large Scale</strong>: Topics are abstract and are made to be applied to future scenarios.</li>
<li><strong>Good for Big Ideas</strong>: Good for generating ideas that will be implemented later (think conference presentations).</li>
</ul>


<p>More on that last point, macrotraining is good for making big leaps.
It&rsquo;s important when an organization/department/team as a whole needs to make a big leap. Everyone needs to buy in.
Everyone needs to get a baseline of knowledge quickly.
Everyone needs a shared framework and language for moving forward.
Examples might include, moving to a new version management system, starting a new service, changing product focus, etc.</p>

<p>While macrotraining is good at making big leaps (at least in theory), microtraining is about continual improvement.
In fact, most organizations think the hard work is done after a macrotraining session.
Actually, the easy part is done. The devil, as they say, is in the details. And that&rsquo;s where microtraining thrives.</p>

<p>Here are some traits of microtraining:</p>

<ul>
<li><strong>Spontaneous</strong>: Training occurs when there is a specific need and happens continually throughout the day.</li>
<li><strong>Democratic</strong>: Everyone can participate even if the feedback is &ldquo;I don&rsquo;t understand what this is doing&rdquo;.</li>
<li><strong>Specific</strong>: The discussion is about solving a particular immediate problem or question.
This does not mean that the discussion cannot go abstract, but it moves that way because the discussion requires a knowledge of an abstract concept. See more below.</li>
<li><strong>Good for Growth and Continual Improvement</strong>: Microtraining is about getting slightly better over time.</li>
</ul>


<p>Microtraining and macrotraining mirror each other, but microtraining is seldom discussed and nearly always undervalued.</p>

<h2>What Does Micro-training Look Like</h2>

<p>Microtraining, in short, is the willingness to give continual feedback and advice.</p>

<p>Here&rsquo;s a couple of examples:</p>

<h3>Learning a New System</h3>

<p>Jane is a new developer and has expressed interest in the deploy process.</p>

<p>The Macrotraining approach would be to schedule a training session in a few weeks.
Some engineer will write up a few powerpoint slides and then run through a demo.
Everyone will feel happy, but Jane will always feel anxiety about dealing with the deploy if she&rsquo;s the only engineer around during a fire.</p>

<p>The Microtraining approach is simpler. Jane expresses interest in the deploy process to her fellow developer Ramit.
Ramit says &ldquo;cool&rdquo; and next time he is about to deploy code he&rsquo;ll walk over to her desk and he&rsquo;ll walk her through the process, stopping to explain any concepts that my be new or unfamiliar.</p>

<p>That&rsquo;s the easy part. Here&rsquo;s the hard part.
The next time there is a deploy, he walks over to Jane&rsquo;s desk and he says &ldquo;go for it.&rdquo;
She&rsquo;ll have forgotten 95% of the steps, but at each point he&rsquo;ll wait for her to puzzle through the next part, making suggestions if she seems really lost until the deploy is live.
The next time there is a deploy. He does it again. Eventually Jane will have mastered the process.</p>

<p>Is it faster? In a way it is, because though there are more sessions, Jane will master the material much quicker.
More importantly, it is personal and immediate (the deploy has to go out after all).</p>

<p>The beauty part is that Ramit has a backup for this process and if he is out or busy or whatever, he knows someone else can take over.</p>

<h3>Improving Code Quality</h3>

<p>Jack is an intern at Hip.io a small web company.
Part of the company policy is code review on all code.
Jack doesn&rsquo;t know much about code reviews, but his supervisor says it&rsquo;s not a big deal and tells him to make at least one pull request a week even if something is not all the way finished (it won&rsquo;t be merged, but a week is long enough before getting feedback).</p>

<p>After the first week, he puts up a small pull request, a couple method tweaks. His very nervous and makes a note about how it&rsquo;s not very good, and he&rsquo;s still working on it.
A few other developers comment on it. One suggests a method that would simplify a sub-routine.
Another reminds Jack of code styling issues on a few parts.
Another suggests that a change could have an impact on a different part of the code and links to the code that is potentially affected.</p>

<p>All in all, Jack feels pretty good. There were changes he will need to make, but it wasn&rsquo;t as terrifying as he expected.
As the weeks go on he starts making comments on other code. First it&rsquo;s a few style changes, but then he makes more and more suggestions.</p>

<p>At the end of the summer, he&rsquo;s noticed a significant improvement in his code craftsmanship.</p>

<h2>Microtraining Anti-patterns</h2>

<p>That all seems so simple that it&rsquo;s a wonder that I&rsquo;m writing about it at all.
But here&rsquo;s the secret: Microtraining has to be deliberate.</p>

<p>Normally, we let work gravitate to those with the most experience.
If someone has a problem, they may ask for help and what happens next is fairly typical.
A more experienced person will &ldquo;look at it&rdquo; and then after a bit, respond, usually by email, that the problem is such and such line and they need to change it to so and so.
Inexperienced person copies and pastes and that&rsquo;s the end of that.</p>

<p>A more charitable experienced developer will walk over to the desk of the questioner with the intention of teaching them something, but, as with most programming problems, when they answer isn&rsquo;t immediately apparent, they, the experienced developer, will commandeer the keyboard and work at it until the problem is solved.
The whole time the less experienced developer either sits and stares bafflingly at the screen or just tunes out altogether.</p>

<p>I&rsquo;ve seen some newer developers so trained to expect this, that the minute I walk over to their desk, they push away from the computer as if they just expect that I will want to take it over.</p>

<p>Each of those examples solves solves the technical problem. But, it&rsquo;s not microtraining; there was no improvement in the process.</p>

<h2>Valuing Microtraining</h2>

<p>Here are a few of steps to add microtraining to an organization:</p>

<ol>
<li><p><strong>Make improving each other&rsquo;s craft an explicit part of a job</strong></p>

<p> This means changing the culture so everyone contributes. Some people may only feel comfortable commenting on pull requests.
That&rsquo;s fine.</p>

<p>  Oh, and by the way, everyone needs to contribute even new developers and interns.</p>

<p>  With interns, a good exercise is to have them lead a demo or walk someone line by line through the code.
They will mostly be on the receiving end of feedback, but they will be learning to articulate their coding decisions.</p></li>
<li><p><strong>Encourage giving and receiving critical, but positive feedback</strong></p>

<p> A mistake a lot of places make is only giving &lsquo;feel good&rsquo; feedback.
In other words, they&rsquo;ll say &ldquo;that looks great!&rdquo; or &ldquo;I like it!&rdquo;.</p>

<p>  A good organization gives critical feedback, but works to make sure that the goal is improvement and not criticizing an individual for &ldquo;not knowing&rdquo; the right way as if we were all born knowing to code.</p></li>
<li><p><strong>Never, ever, take over the keyboard</strong></p>

<p> This will make each interaction twice as long, but it&rsquo;s worth it.</p></li>
<li><p><strong>Find out what people are interested in and encourage them to observe</strong></p>

<p> This is the closes microtraining gets to planning.
Some developers are good at being proactive, some need encouragement.
Find out what they are interested in and have the observe one of the senior people as they work on it.
The senior dev will, of course, be explaining what they are doing.</p>

<p>  If people don&rsquo;t have an interest, well, then pick something for them.
Part of microtraining is learning to appreciate stretching to learn new things.</p></li>
</ol>


<p>In the end, an organization built around learning and continual improvements will be better overall.
There will be quantifiable business benefits (fewer bugs, faster fixes during fires), but the majority of benefits will be harder to quantify (cleaner code, team cohesion, higher morale).
It&rsquo;s not difficult, but with most things in life, the hardest part is making it a part of the culture.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-11-17T08:56:21-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/leadership/'>leadership</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/11/16/react-component-3-ways/">
		
			React Component 3 Ways</a>
	</h2>
	<div class="entry-content">
		<h1>React Components 3 ways</h1>

<p>I&rsquo;ve been building a small react app as part of a larger project.
I&rsquo;ve also recently been trying to create a culture of pull requests and code reviews in the team.
A few people are interested. Most aren&rsquo;t.
However, for the few that have been interested, I&rsquo;ve faced an interesting challenge. Nearly no one is a javascript developer.</p>

<p>Sure, they&rsquo;ve written some jquery here and added a plugin there, but no one has really taken the time to learn about the language.
I&rsquo;m not saying that to be critical, many are better PHP and Python developers than I am, but it&rsquo;s a fact that a lot of javascript
looks a little strange to them.</p>

<p>So, we I first committed this code, a standard React component taken almost verbatim from the documentation, I got a lot of confused responses:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Menu</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">data</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>        <span class="nx">filterTag</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">componentDidMount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://someapiendpoint.com/api&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">jsonpCallback</span><span class="o">:</span> <span class="s1">&#39;callback&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">stories</span><span class="p">});</span>
</span><span class='line'>        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">handleTagClick</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">filterTag</span><span class="o">:</span> <span class="nx">tag</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span><span class="p">(</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">TagList</span> <span class="nx">tags</span><span class="o">=</span><span class="p">{</span><span class="nx">getTags</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">)}</span> <span class="nx">onTagClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleTagClick</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">FilterableList</span> <span class="nx">items</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span> <span class="nx">filterTag</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">filterTag</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>One code reviewer asked me to break it into functions to make it more readable.
I wasn&rsquo;t sure how to respond and finally said, &ldquo;but it is broken into functions. I&rsquo;m passing an object with defined functions into a factory.&rdquo;</p>

<p>He responded, that was fine and I admitted he didn&rsquo;t know much about React or javascript.
However, that didn&rsquo;t feel right to me.
He is a good developer and I&rsquo;ve always told code reviewers that saying that code is too confusing is perfectly good feedback.</p>

<p>I decided, therefore, to try again. This time, I explicitly built the object before passing it to the factory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Menu</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Menu</span><span class="p">.</span><span class="nx">getInitialState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">data</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>    <span class="nx">filterTag</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Menu</span><span class="p">.</span><span class="nx">componentDidMount</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://someapiendpoint.com/api&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">jsonpCallback</span><span class="o">:</span> <span class="s1">&#39;callback&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">stories</span><span class="p">});</span>
</span><span class='line'>    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Menu</span><span class="p">.</span><span class="nx">handleTagClick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">filterTag</span><span class="o">:</span> <span class="nx">tag</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Menu</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span><span class="p">(</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">TagList</span> <span class="nx">tags</span><span class="o">=</span><span class="p">{</span><span class="nx">getTags</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">)}</span> <span class="nx">onTagClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleTagClick</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">FilterableList</span> <span class="nx">items</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span> <span class="nx">filterTag</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">filterTag</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">(</span><span class="nx">Menu</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll admit, I liked this way a lot better. It&rsquo;s much more clean and easier to skim.
The code reviewer also preferred the new way.</p>

<p>Again, I could have left it at that, but I decided to go one step further.
I&rsquo;ve already been writing most of the code using es6, but thus far I have avoided the <code>class</code> keyword.
Maybe I&rsquo;m just an old crotchety javascript dev, or maybe I&rsquo;m too easily influenced by other  <a href="https://vimeo.com/97419177">old</a> and <a href="https://medium.com/javascript-scene/how-to-fix-the-es6-class-keyword-2d42bb3f4caf">crotchety</a> javascript developers, but I don&rsquo;t particularly like the <code>class</code> keyword.</p>

<p>Nonetheless, in the name of reusability and team cohesion, I decided to give it a try. Plus, a lot of <a href="https://github.com/airbnb/javascript#constructors">good style guides</a> say to use it.
So, I made a third example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">class</span> <span class="nx">Menu</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * React components using ES6 classes no longer autobind this to non React methods.</span>
</span><span class='line'><span class="cm">     * https://github.com/goatslacker/alt/issues/283</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">handleTagClick</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleTagClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">data</span><span class="o">:</span> <span class="p">[],</span>
</span><span class='line'>      <span class="nx">filterTag</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://someapiendpoint.com/api&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;jsonp&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">jsonpCallback</span><span class="o">:</span> <span class="s1">&#39;callback&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">stories</span><span class="p">});</span>
</span><span class='line'>      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">handleTagClick</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">filterTag</span><span class="o">:</span> <span class="nx">tag</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span><span class="p">(</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">TagList</span> <span class="nx">tags</span><span class="o">=</span><span class="p">{</span><span class="nx">getTags</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">)}</span> <span class="nx">onTagClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleTagClick</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">FilterableList</span> <span class="nx">items</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span> <span class="nx">filterTag</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">filterTag</span><span class="p">}</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="nx">Menu</span>
</span></code></pre></td></tr></table></div></figure>


<p>By this point, the reviewer was thrilled. And I&rsquo;ll admit, for people coming from other OO languages, and particularly PHP, this will be a lot more familiar.
Personally, I like the second version best. Although, really that&rsquo;s just because it looks like &ldquo;real&rdquo; javascript to me (whatever that means).</p>

<p>However, writing good code is about compormise. We compromise abstractions for the sake of time. We compromise cohesion for the sake of (visual) design.
And sometimes we need to check our own preferences for the sake of the team.
Each version works perfectly fine, but one will have a much greater chance of being used by others in the future. And really, that&rsquo;s the most important thing.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-11-16T15:50:52-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/09/03/creating-scrolling-self-drawing-lines/">
		
			Creating Scrolling Self-Drawing Lines</a>
	</h2>
	<div class="entry-content">
		<p>First of all here&rsquo;s a demo. Scroll inside the codepen to view:</p>

<p data-height="268" data-theme-id="0" data-slug-hash="QjNbgz" data-default-tab="result" data-user="jsmapr1" class='codepen'>See the Pen <a href='http://codepen.io/jsmapr1/pen/QjNbgz/'>QjNbgz</a> by Joe Morgan (<a href='http://codepen.io/jsmapr1'>@jsmapr1</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<p>My office recently designed a campaign to encourage student applications as a deadline neared.
Our goal was to create a very unique and engaging page for potential students and the designers settled on a theme of motion and inertia.
Translating that into an experience on the web was a little more difficult.
We needed something that pulled the viewer along, that interacted with them, but did not try to control the pace.
After taking inspiration from a few sites (<a href="http://pitchfork.com/features/cover-story/reader/streaming/">particularly this one</a>) we created a design that would generate a self drawing line that responded to the user as they scrolled.
When a user scrolled down the page, the line drawing would be built. If they scrolled backwards, it would undo itself.</p>

<p>The concept was simple and effective. It was unique enough to create an experience that would engage the viewer and set us apart from the noise.
The best part was that the JavaScript ended up being surprisingly simple. Here are the steps in brief:</p>

<ol>
<li>Calculate the length of an SVG</li>
<li>Create a dash the length of the SVG (making it appear invisible)</li>
<li>Set a start point and an end point relative to the top and bottom of the svg (could also be relative to another element)</li>
<li>Calculate the distance between the top and the bottom</li>
<li>Calculate the amount of pixels that must be added per pixel of vertical scroll</li>
<li>Attach an method to the scroll event that adds pixels (removes the dash)</li>
</ol>


<p>Not bad, huh?</p>

<h2>Calculate the length of an SVG</h2>

<p>This is actually pretty straight forward. The key is having an SVG that is only a path:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;svg</span>  <span class="na">enable-background=</span><span class="s">&quot;new 0 0 612 792&quot;</span> <span class="na">version=</span><span class="s">&quot;1.1&quot;</span> <span class="na">viewBox=</span><span class="s">&quot;0 0 612 792&quot;</span> <span class="na">x=</span><span class="s">&quot;0px&quot;</span> <span class="na">y=</span><span class="s">&quot;0px&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">&quot;M133.7-2.2l157.1,368V792&quot;</span> <span class="na">fill=</span><span class="s">&quot;none&quot;</span>    <span class="na">id=</span><span class="s">&quot;line&quot;</span> <span class="na">stroke=</span><span class="s">&quot;#E11837&quot;</span> <span class="na">stroke-miterlimit=</span><span class="s">&quot;10&quot;</span> <span class="na">stroke-width=</span><span class="s">&quot;2&quot;</span> <span class="nt">&gt;&lt;/path&gt;</span>
</span><span class='line'><span class="nt">&lt;/svg&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can easily get the length of the path using a <a href="https://developer.mozilla.org/en-US/docs/Web/API/SVGPathElement">path method</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span><span class='line'><span class="c1">//826.331</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create a dash the length of the SVG</h2>

<p>With the length of the path calculated, make dash on the path that is the exact same lenght.
This will make the path invisible:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">path</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Set a start point and an end point relative to the top and bottom of the SVG</h2>

<p>The next step is where it gets a little tricky.
There needs to be a starting and a stopping point on the screen to trigger the beginning (or end) of the animation.
This will be determined by calculating the distance of the start point from the top of the page.
To determine this, I used the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRec://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect">getBoundClinetRect method</a>.
This works on any html element and returns a nice object giving the location of the element&rsquo;s bounds <em>relative to the viewPort</em>.</p>

<p>The result looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">path</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">bottom</span><span class="o">:</span> <span class="mf">2455.22607421875</span>
</span><span class='line'>    <span class="nx">height</span><span class="o">:</span> <span class="mf">1816.79736328125</span>
</span><span class='line'>    <span class="nx">left</span><span class="o">:</span> <span class="mf">215.84967041015625</span>
</span><span class='line'>    <span class="nx">right</span><span class="o">:</span> <span class="mf">575.228759765625</span>
</span><span class='line'>    <span class="nx">top</span><span class="o">:</span> <span class="mf">638.4287109375</span>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="mf">359.3790893554687</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>From that we need to find the absolute position.
To do that, get the top position of the body tag.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
</span><span class='line'><span class="c1">//-427</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since this is relative to the view port, it will almost certainly be a negative number.
To get the start point relative to the top of the body, just subtract the top of the body from the top of the element.
From above, this would be 638 - -427. So the start of the element is 1065 pixels from the top of the page.
Now this will all be fine except for that would start the animation when the top of the element is at the top of the viewPort.
The result is that the animation would always be just barely out of view.
That is less than ideal and wouldn&rsquo;t create the desired effect.</p>

<p>The last step is subtracting the distance from the top of the viewPort that we want the effect to start resulting in a start point start point <em>above</em> the top of the SVG.
In other words, if an SVG starts 1000px from the top of the body and the viewport is 100px high (why not) and we want it to start when the top of the SVG is in the middle of the viewport, then the animation <em>really</em> needs to start 950px from the top of the body.
The ability to set the start and stopping point is one of the best ways to control the speed and visual affect of an SVG.
If we want the SVG to coming shooting out of the top of the screen, we can set it to start after the page has past it&rsquo;s starting point (make it a negative number, -2).
If we want the SVG to begin before we hit a visible area, all we need to do is set the start number higher than 1 (1.2) for example.</p>

<p>The end point is pretty much the same, except we get the bottom of the SVG bounding container. Everything else is the same.</p>

<h2>Calculate the distance between the top and the bottom</h2>

<p>With the start and the end points set, the distance is a simple subtraction.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, we need to be able to recalculate this on the fly.
So we really need to know both the total distance and  the remaining distance.
This can be figured out using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollY">window.pageYOffset/window.scrollY</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span><span class="nx">Defined</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">animate</span> <span class="nx">line</span> <span class="kd">function</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">distanceRemaining</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Calculate the amount of pixels that must be added per pixel of vertical scroll</h2>

<p>With the SVG length and starting and stopping points established, all that&rsquo;s left is to figure out how much to add reveal as the user scrolls down.
That is easily accomplished with a simple function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span> <span class="nx">Add</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">prototype</span>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pixelsPerVerticalScroll</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Attach an method to the scroll event that adds pixels (removes the dash)</h2>

<p>Finally, we just need to attach a method to the scroll event so that the line will be continually updated.
It&rsquo;s going to have three parts:</p>

<ol>
<li>If we are before the start point: Show nothing.</li>
<li>If we are after the end poing: Show everything.</li>
<li>If we are between the start and the end point: Show the correct percentage.</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span> <span class="nx">Attach</span> <span class="nx">the</span> <span class="nx">scroll</span> <span class="nx">even</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">init</span> <span class="kd">function</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">animateLine</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">distanceRemaining</span><span class="p">()</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">pixelsPerVerticalScroll</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Initializing</h2>

<p>The initialization will set most of the values:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Scroller</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">el</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//Animation will end when the end is at which point of othe page. .9 is at about 90% down the page/</span>
</span><span class='line'>  <span class="c1">// .1 is 10% from the top of the page. Default is middle of the page.</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">startPoint</span> <span class="o">||</span> <span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">endPoint</span> <span class="o">||</span> <span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">containerBounds</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPagePosition</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPagePosition</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>From there, we can easily add as many as we want. All we need is an ID on the SVG</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">new</span> <span class="nx">Scroller</span><span class="p">({</span>
</span><span class='line'>  <span class="s1">&#39;el&#39;</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;mySvg&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="s1">&#39;startPoint&#39;</span><span class="o">:</span> <span class="nx">startPoint</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;endPoint&#39;</span><span class="o">:</span> <span class="nx">endPoint</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>There were a few other ideas I played with. I considered adding a stop and start to a container element rather than the SVG itself.
This wouldn&rsquo;t be too hard, the only change would be to specify the startPoint and endPoint belong to a different element.
I also considered adding a pause point, but that required too many extra considerations that would depend on screen width and such.
For now, I left it simple and it worked out very well.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-03T16:49:04-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>

<nav id="pagenavi">
    
        <a href="1" class="prev">Prev</a>
    
    
        <a href="3" class="next">Next</a>
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Joe

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84697313-1');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
