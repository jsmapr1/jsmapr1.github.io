
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Building Production Ready React  | Dev</title>

<meta name="author" content="Joe"> 

<meta name="description" content="Production Ready React React is still an evolving project.
Add to that complications of needing to transpile any javascript with ES6 syntax and you &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Dev" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Dev</a></h1>
<h4>The Art of Working With Code(rs)</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thejoemorgan.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Building Production Ready React</h2>
	<div class="entry-content"><h2>Production Ready React</h2>

<p>React is still an evolving project.
Add to that complications of needing to transpile any javascript with ES6 syntax and you have best practices that are, at best, a moving target.
After running into a few issues, I wanted to get all the information I have together in one accessible place.</p>

<p>Here are my goals for the current project:</p>

<ul>
<li>Write code in ES6 syntax (but compiled so that it can be cross-browser compatible)</li>
<li>Make production code as small as possible including all dependencies</li>
<li>Make the project easy to deploy and hand off to other developers</li>
</ul>


<p>This list seemed fairly simple, but there were a few surprises that I did not anticipate.</p>

<h3>ES6 Syntax</h3>

<p>Writing in ES6 (ES2015, whatever) is practically required at this point for a javascript developer.
I, like most, opted for one of the most popular transpilers: <a href="https://babeljs.io/">babel</a>.
This set up is pretty standard (note: I&rsquo;ll be using browserify):</p>

<p><code>npm install --save-dev babelify</code></p>

<p>Most tutorials stop here, but there have been some changes to the project in the last 6 months.
In addition to the base transpiler, we have to install presets so that babelify will work with the various syntax oddities:</p>

<p><code>npm install --save-dev babel-preset-es2015 babel-preset-react</code></p>

<p>One of the big advantages of ES6 and modern javascript development is the ability to create modules so that code can be broken up and included in different files.
The two big contenders for handling this are <a href="http://browserify.org/">browserify</a> and <a href="https://webpack.github.io/">webpack</a>.
Honestly, they seem equally good for me, so I went with browserify for absolutely no specific reason.</p>

<p>Anyway, install that: <code>npm install --save-dev browserify</code>.</p>

<p>After that to build we just need to run:</p>

<p><code>browserify js/app.js -t [ babelify --presets [ es2015 react ] ] &gt; public/js/app.js</code></p>

<p>Again, the secret is to make sure the presets are listed otherwise it won&rsquo;t work and you will receive a very unhelpful error message:</p>

<p><code>ParseError: 'import' and 'export' may appear only with 'sourceType: module'</code></p>

<p>I burned a lot of time trying to figure out what was causing the error.
Turns out it I merely had not included the presets.</p>

<h2>Small Size</h2>

<p>The next step is to pipe everything through <a href="https://github.com/mishoo/UglifyJS2">uglify</a> to get it nice and minimized:</p>

<p><code>npm install --save-dev uglify</code></p>

<p>and then:</p>

<p><code>browserify js/app.js -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js</code></p>

<p>As an example, the first transformation (browserify + babelify) made my code usable in a browser and it weighed in at 950 kb.
Minification made it much smaller at 314 kb. However, that wasn&rsquo;t quite small enough for me.</p>

<p>After looking at the [react documentation] (<a href="https://facebook.github.io/react/downloads.html#npm">https://facebook.github.io/react/downloads.html#npm</a>) I noticed that there was a production and a development mode for React.
The instructions are not very clear on how to achieve production mode, but after a little experimentation, I found the key is to use envify (as suggested in the documentation).</p>

<p><code>npm install --save-dev envify</code></p>

<p>And then add that to the browserify command:</p>

<p><code>browserify js/app.js -g [envify --NODE_ENV 'production'] -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js</code></p>

<p>The <code>-g</code> flag is a global transform that applies to all files after the babelify transforms run. The result is 260 kb file.</p>

<h3>Easy To Give to Other Developers</h3>

<p>To make things even easier, I added that all to my package.json file so that it can be run from the command line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;browserify js/app.js -g [envify --NODE_ENV &#39;production&#39;] -t [ babelify --presets [ es2015 react ] ]| uglifyjs -c -m &gt; public/js/app.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>This can be run with the command: <code>npm run build</code></p>

<h3>Small Enough?</h3>

<p>The one thing that bothered me, was the code still seemed very large compared to using the official minified version of React.</p>

<p>The minified version of react is only 145 kb and jquery (which I&rsquo;m using mostly for ajax) is only 34 kb. So where does the extra size come from?</p>

<p>As an experiment to get the smallest size, I used <a href="https://github.com/thlorenz/browserify-shim">browserify-shim</a>. This allows me to set global variables so that I can both include them in the script, but not combine the library into the final minified file.</p>

<p>For example, I can begin a script with this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">DropDown</span> <span class="nx">from</span> <span class="s1">&#39;./DropDown.jsx&#39;</span><span class="p">;</span>
</span><span class='line'><span class="kr">import</span> <span class="nx">FilterableList</span> <span class="nx">from</span> <span class="s1">&#39;./FilterableList.jsx&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>but browserify-shim knows that React and Jquery will be global variables, so it creates a reference to the global
rather than packaging the React object in the final file.</p>

<p>To make this work, all we need to do is add browserify-shim to our node modules: <code>npm install --save-dev browserify-shim</code>.
And then in our package.json, we update the script to use browserify-shim and we specify which imports should be ignored.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;build&quot;</span><span class="o">:</span> <span class="s2">&quot;browserify js/app.js -g [envify --NODE_ENV &#39;production&#39;] -t [ babelify --presets [ es2015 react ] ]  -t browserify-shim | uglifyjs -c -m &gt; public/js/app.js&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="s2">&quot;browserify-shim&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;react&quot;</span><span class="o">:</span> <span class="s2">&quot;global:React&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;react-dom&quot;</span><span class="o">:</span> <span class="s2">&quot;global:ReactDOM&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;jquery&quot;</span><span class="o">:</span> <span class="s2">&quot;global:$&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And, of course, now the minified versions must be included in the page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://fb.me/react-with-addons-0.14.5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://fb.me/react-dom-0.14.5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://code.jquery.com/jquery-2.1.4.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;public/js/app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The final result is a combined total of 195 kb. Why it gets so much smaller, I&rsquo;m not quite sure.
Honestly, I still haven&rsquo;t decided if the extra size is worth the latency of fetching that many more files, but a drop of over 33% is nothing to walk away from.
For now, I like having the option. Some throttled and mobile testing later will help decide if it is worth it.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-12-02T16:28:24-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/react/'>react</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Joe

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84697313-1');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
