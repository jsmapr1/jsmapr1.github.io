
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Protractor in Iframe  | Dev</title>

<meta name="author" content="Joe"> 

<meta name="description" content="Working With Iframes in Protractor One of the hardest parts of legacy system is finding the confidence to refactor code. It&rsquo;s not a matter of &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Dev" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Dev</a></h1>
<h4>The Art of Working With Code(rs)</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thejoemorgan.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Protractor in Iframe</h2>
	<div class="entry-content"><h1>Working With Iframes in Protractor</h1>

<p>One of the hardest parts of legacy system is finding the confidence to refactor code. It&rsquo;s not a matter of if one will have to refactor code, but rather the question is when and how much.</p>

<p>If you happen to be lucky enough to inherit a well documented and well tested system, then good for you. If only we were all so lucky. Most of us inherit systems that are not so easy, but again, the need to refactor will present itself eventually.</p>

<p>When I started building tests into the system, I did what many do and focused on unit test first. I even wrote tests for some of the more important code (or some of the code that had a bad habit of being broken). However, this didn&rsquo;t help much with refactoring because a lot of the code was tangled spaghetti code that needed to be refactored before tests could even be written. Enter end-to-end testing.</p>

<h1>End to End Tests</h1>

<p>In our particular case, the largest problem is that nearly every feature has customizations for clients. Some customizations are used by only one person and are so obscured by the code that it&rsquo;s hard to notice until it&rsquo;s too late. Previously, we have been bad developers and either checked a sampling of clients by hand (always missing one or two exceptions) or, more likely, relying on QA to check a sampling of clients by hand (still missing at least one edge case).</p>

<p>Hoping to find a better way, we have started using protractor for end-to-end testing. Currently, we have just been using it for refactoring, but eventually we will use it to keep better track of different client specific code alterations. Eventually, as code coverage of unit tests expand this may be less necessary, but for now it serves both as a test and as a form of documentation.</p>

<h1>Use Case</h1>

<p>Protractor is pretty simple and the documentation has been pretty good, so I won&rsquo;t go through the set up and all that. I did however have a problem with capturing information in iframes. The refactoring project is converting modals from jquery-ui, which uses iframes, to angular-ui which uses bootstrap and ajax.</p>

<p>With protractor generally, you just select the xpath and use that to run the test. However, when an iframe is involved, we need to first switch contexts. This is all modified from this <a href="http://stackoverflow.com/questions/20425909/protractor-testing-angular-app-in-an-iframe">great stackoverflow answer.</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;angularjs homepage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prot</span><span class="p">,</span> <span class="nx">driver</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prot</span> <span class="o">=</span> <span class="nx">protractor</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">driver</span> <span class="o">=</span> <span class="nx">prot</span><span class="p">.</span><span class="nx">driver</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">browser</span><span class="p">.</span><span class="nx">ignoreSynchronization</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should open reservation modal&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// First load the client</span>
</span><span class='line'>      <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://someclient.localhost/reserver&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// Then click to open the modal. Don&#39;t care which one, so click the first button.</span>
</span><span class='line'>      <span class="nx">element</span><span class="p">(</span><span class="nx">by</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;.reserve_button&#39;</span><span class="p">)).</span><span class="nx">click</span><span class="p">();</span>
</span><span class='line'>      <span class="c1">// Now, switch to the iframe</span>
</span><span class='line'>      <span class="nx">prot</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">().</span><span class="nx">frame</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">protractor</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;reservation_dialog&quot;]/iframe&#39;</span><span class="p">)));</span>
</span><span class='line'>      <span class="c1">// Then get the element by xpath</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">modal</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">protractor</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">modal</span><span class="p">.</span><span class="nx">getText</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="sr">/Reserve Now/</span><span class="p">);</span>
</span><span class='line'>    <span class="p">})})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s all pretty simple, but not well covered in documentation. So here it is for all eternity.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-01-08T15:12:10-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Joe

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84697313-1');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
