
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>JavaScript Generators: A Practical Example  | Dev</title>

<meta name="author" content="Joe"> 

<meta name="description" content="Generators: Who Cares Generators may be the most misunderstood feature of ES6.
Personally, I&rsquo;ve read at least half a dozen articles purporting &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Dev" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Dev</a></h1>
<h4>The Art of Working With Code(rs)</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thejoemorgan.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">JavaScript Generators: A Practical Example</h2>
	<div class="entry-content"><h2>Generators: Who Cares</h2>

<p>Generators may be the most misunderstood feature of ES6.
Personally, I&rsquo;ve read at least half a dozen articles purporting to explain them and all I can ever think is &ldquo;but why would I use them?&rdquo;</p>

<p>Turns out I&rsquo;m not alone. No one uses them.</p>

<p><img src="/images/generatorSurvey.png"></p>

<p>However, that doesn&rsquo;t mean they don&rsquo;t matter.
It&rsquo;s possible that soon we will love them and use them all the time.
We just need to understand the problem they solve and see how they add value.</p>

<h2>A Practical Example</h2>

<p>I spend a lot of time reading code.
And recently I decided to find someone, anyone, who used generators.</p>

<p>Well, I found it!
<a href="https://github.com/Khan">Khan Academy</a> has a few projects that use generators.
Specifically, their project <a href="https://github.com/Khan/algebra-tool">Algebra Tool</a> uses generators in a way that makes a lot of sense.</p>

<p>It&rsquo;ll take awhile to show what they are doing, but I&rsquo;ll go ahead and give the take away.
Khan Academy, or rather the developers at Khan Academy, are using generators to turn objects and complex data structures into iterables.
In other words, they are using generators to treat objects like arrays.</p>

<p>This makes a lot of sense to me. As I&rsquo;ll show, they have a rather complex data structure, but they keep the complexity hidden behind a simple interface.
This gives them the ability to leverage value from the data structure without requiring other parts of the program to understand the structure.</p>

<p>Now a quick caveat: This is not live production production code.
It&rsquo;s code that resulted from a day-long hack-a-thon.
However, I wouldn&rsquo;t be surprised if something similar exists in prodution.
And even if it doesn&rsquo;t, it easily could.
So we&rsquo;ll dive into it as if it were highly polished and live.</p>

<h2>Project Design</h2>

<p>First, here&rsquo;s a look at the project.</p>

<p><img src="/images/algebraTool.png"></p>

<p>They are creating an online tool for students to manipulate and work with algebraic expressions.</p>

<p>The expression in this calculator is built with a class called, wait for it, <code>Expression</code>.</p>

<p>Here&rsquo;s a sample of the <a href="https://github.com/Khan/algebra-tool/blob/master/src/ast/expression.js">Expression Class</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Expression</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">constructor</span><span class="p">(...</span><span class="nx">nodes</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kr">super</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;Expression&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">List</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">...</span><span class="nx">nodes</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">}</span><span class="o">:</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">toString</span><span class="p">()}</span><span class="err">`</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">toJSON</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">...</span><span class="kr">super</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(),</span>
</span><span class='line'>            <span class="nx">children</span><span class="o">:</span> <span class="p">[...</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">child</span> <span class="o">=&gt;</span> <span class="nx">child</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">())],</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">clone</span><span class="p">(</span><span class="nx">uniqueId</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>We won&rsquo;t go through this code line-by-line.
All we need to know is that <code>Expression</code> takes a series of nodes and creates a new instance of a <code>List</code>.</p>

<h2>Data Structure</h2>

<p>For simplicity, we&rsquo;ll ignore the implementation details, all we need to know is that <code>List</code> will create a data structure known as a <a href="https://code.tutsplus.com/articles/data-structures-with-javascript-singly-linked-list-and-doubly-linked-list--cms-23392">linked list</a>.</p>

<p>When you create an instance of a new instance of <code>Expression</code> it will look similar to this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Expression</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">3</span><span class="p">})</span>
</span><span class='line'><span class="nx">e</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">first</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">last</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The trick is that every node knows what node is after it. (It also knows the previous node, but we are leaving that out for simplicity).</p>

<p>Now, this is important because a mathematical expression needs to know what symbols are surrounding it.
For example, <code>3 • x + 5</code> makes sense and is a valid algebraic expression while <code>3 • + x 5</code> is not valid and does not make sense.</p>

<p>We can seen, then, why the developers would use this data structure.
The problem is that now they are locked into certain language constraints.
Since they are using an object, and a deeply nested object at that, they cannot utilize certain methods that they could have on, say, an array.</p>

<p>As a demonstration, let&rsquo;s return to the <code>toString</code> method on the <code>Expression</code> class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">}</span><span class="o">:</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">toString</span><span class="p">()}</span><span class="err">`</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nothing exciting here. Notice, though, that it calls the <code>children.toString</code> method.
Since children are an instance of the <code>List</code> class, let&rsquo;s look at that method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">List</span> <span class="kr">extends</span> <span class="nx">Node</span> <span class="p">{</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>  <span class="nx">toString</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">node</span> <span class="nx">of</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">result</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">result</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s no need to really understand what&rsquo;s going on.
The trick is in this line: <code>for (let node of this)</code>.</p>

<p>Sure. It seems normal.
The problem is that line should not work.
The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of">for&hellip;of loop</a> does not work on objects.</p>

<h2>Objects and Iterators</h2>

<p>Here&rsquo;s an example of a simple <code>for ... of</code> loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">presentation</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="s1">&#39;ES6 Patterns in the Wild&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;Joe Morgan&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">metadata</span> <span class="nx">of</span> <span class="nx">presentation</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ES 6 Patterns in the Wild</span>
</span><span class='line'><span class="c1">// Joe Morgan</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s so simple it&rsquo;s almost not worth exploring.
It iterates over each property in the array and logs it.</p>

<p>What happens if we were to try the same loop on an object?
Well, it won&rsquo;t work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">presentation</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;ES6 Patterns in the Wild&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;Joe Morgan&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">metadata</span> <span class="nx">of</span> <span class="nx">presentation</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="nx">TypeError</span><span class="o">:</span> <span class="nx">presentation</span><span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="kd">function</span>
</span></code></pre></td></tr></table></div></figure>


<p>So what is that mysterious <code>Sybmol.iterator</code>.</p>

<p>Well, according to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/iterator">mdn</a>:
<em>The Symbol.iterator well-known symbol specifies the default iterator for an object. Used by for&hellip;of.</em></p>

<p>If that explains seems circular to you. Don&rsquo;t worry. It is.</p>

<p>Suffice it to say, the <code>Symbol.iterator</code> tells a for loop how to work.
It&rsquo;s defined for you on arrays (and strings and a couple other things), but not on objects.</p>

<p>However, that&rsquo;s not a problem. We can define our own!
And that&rsquo;s were generators come in.</p>

<h2>Symbols and Generators</h2>

<p>Ok. Now we get to the good part.</p>

<p>Let&rsquo;s look at how a generator is used in Khan Academy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">List</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'>    <span class="o">*</span><span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">first</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="nx">node</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">let</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
</span><span class='line'>        <span class="k">yield</span> <span class="nx">current</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll step through this more thoroughly in a moment.
For now, notice that they are defining their own <code>Symbol.iterator</code> for the list.
That&rsquo;s how they were able to loop through it at all.</p>

<p>Next, notice the <code>*</code> in front of the function name and the <code>yield</code> keyword.
That&rsquo;s a clue that this is a generator.</p>

<p>Now that we&rsquo;ve established that it is, in fact, a generator, how does a generator work?
There are essentially two ways to use a generator.</p>

<p>1) We can step through it incrementally.</p>

<p>2) We loop through it.</p>

<p>By example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span><span class="o">*</span><span class="nx">simple</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">yield</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">yield</span><span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>    <span class="k">yield</span><span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>1) Step through it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">simple</span><span class="p">();</span>
</span><span class='line'><span class="nx">y</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="c1">// { value: 1, done: false }</span>
</span><span class='line'>
</span><span class='line'><span class="nx">y</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="c1">// { value: 2, done: false }</span>
</span><span class='line'>
</span><span class='line'><span class="nx">y</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="c1">// { value: 3, done: false }</span>
</span><span class='line'>
</span><span class='line'><span class="nx">y</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="c1">// { value: undefined, done: true }</span>
</span></code></pre></td></tr></table></div></figure>


<p>2) Loop through it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">for</span><span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="nx">simple</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 1</span>
</span><span class='line'><span class="c1">// 2</span>
</span><span class='line'><span class="c1">// 3</span>
</span></code></pre></td></tr></table></div></figure>


<p>As a bonus. Loops are used by the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">spread operator</a>, so whenver we define something that can use a <code>for...of</code> loop we also get the spread operator as a bonus.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">simple</span><span class="p">();</span>
</span><span class='line'><span class="p">[...</span><span class="nx">z</span><span class="p">];</span>
</span><span class='line'><span class="c1">// [1, 2, 3]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pretty neat, huh?</p>

<p>Back to our example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">*</span><span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">let</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">first</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="nx">node</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
</span><span class='line'>    <span class="k">yield</span> <span class="nx">current</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">yield</span> <span class="k">this</span><span class="p">.</span><span class="nx">last</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You do not need to define every single <code>yield</code> statement, as long as there is something to yield.
The generator will return it.</p>

<p>Looking back at our original data structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Expression</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">3</span><span class="p">})</span>
</span><span class='line'><span class="nx">e</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">first</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">last</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The generator will yield the first node and the <code>toString</code> method will grab the id.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then it will yield the next node and the <code>toString</code> method will grab the id.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">next</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, it will grab the next node which is the same as the last node.
At this point the <code>while</code> loop is resolved.
Finally, the last node is yielded and the generator is resolved.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In essence, the generator turned the linked list into an array.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kr">const</span> <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Expression</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">3</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Kinda sorta</span>
</span><span class='line'><span class="nx">e</span> <span class="o">=</span> <span class="p">[{</span><span class="nx">id</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span><span class="mi">3</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>What&rsquo;s the point?</h2>

<p>Now we can see how the generator worked in this example.
But that doesn&rsquo;t resolve the question of why?</p>

<p>Really, it comes down to crafting quality code.
Khan Academy wanted to use a particular data structure, but they didn&rsquo;t want to burden the rest of the app with knowledge of the data structure.
The generator allows them to utilize the advantages of a data structure while allowing other parts of the app to merely assume it is an array.
They can do whatever they might want with the data:
loop through it, spread it, and so on.</p>

<p>In other words. The code is as complicated as it needs to be while be as simple as it can be.</p>

<p>And isn&rsquo;t that the point of any language feature or library?
It allows us to do the most work with the most elegance.</p>

<p>As for me, I have read many articles about generators, but it wasn&rsquo;t until I dug into this example that I really could envision a use case.</p>

<p>If you&rsquo;re curious, no I haven&rsquo;t used one in production.
I wrote one at one point, but ended up taking it out because there was a simpler and clearer way to do the same thing.
So that&rsquo;s the direction I went.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-01-17T07:51:58-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Joe

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84697313-1');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
