
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>The Art of Working With Code(rs)  | Dev</title>

<meta name="author" content="Joe"> 

<meta name="description" content="First of all here&rsquo;s a demo. Scroll inside the codepen to view: See the Pen QjNbgz by Joe Morgan (@jsmapr1) on CodePen. My office recently &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Dev" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Dev</a></h1>
<h4>The Art of Working With Code(rs)</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:www.thejoemorgan.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/09/03/creating-scrolling-self-drawing-lines/">
		
			Creating Scrolling Self-Drawing Lines</a>
	</h2>
	<div class="entry-content">
		<p>First of all here&rsquo;s a demo. Scroll inside the codepen to view:</p>

<p data-height="268" data-theme-id="0" data-slug-hash="QjNbgz" data-default-tab="result" data-user="jsmapr1" class='codepen'>See the Pen <a href='http://codepen.io/jsmapr1/pen/QjNbgz/'>QjNbgz</a> by Joe Morgan (<a href='http://codepen.io/jsmapr1'>@jsmapr1</a>) on <a href='http://codepen.io'>CodePen</a>.</p>


<script async src="//assets.codepen.io/assets/embed/ei.js"></script>


<p>My office recently designed a campaign to encourage student applications as a deadline neared.
Our goal was to create a very unique and engaging page for potential students and the designers settled on a theme of motion and inertia.
Translating that into an experience on the web was a little more difficult.
We needed something that pulled the viewer along, that interacted with them, but did not try to control the pace.
After taking inspiration from a few sites (<a href="http://pitchfork.com/features/cover-story/reader/streaming/">particularly this one</a>) we created a design that would generate a self drawing line that responded to the user as they scrolled.
When a user scrolled down the page, the line drawing would be built. If they scrolled backwards, it would undo itself.</p>

<p>The concept was simple and effective. It was unique enough to create an experience that would engage the viewer and set us apart from the noise.
The best part was that the JavaScript ended up being surprisingly simple. Here are the steps in brief:</p>

<ol>
<li>Calculate the length of an SVG</li>
<li>Create a dash the length of the SVG (making it appear invisible)</li>
<li>Set a start point and an end point relative to the top and bottom of the svg (could also be relative to another element)</li>
<li>Calculate the distance between the top and the bottom</li>
<li>Calculate the amount of pixels that must be added per pixel of vertical scroll</li>
<li>Attach an method to the scroll event that adds pixels (removes the dash)</li>
</ol>


<p>Not bad, huh?</p>

<h2>Calculate the length of an SVG</h2>

<p>This is actually pretty straight forward. The key is having an SVG that is only a path:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;svg</span>  <span class="na">enable-background=</span><span class="s">&quot;new 0 0 612 792&quot;</span> <span class="na">version=</span><span class="s">&quot;1.1&quot;</span> <span class="na">viewBox=</span><span class="s">&quot;0 0 612 792&quot;</span> <span class="na">x=</span><span class="s">&quot;0px&quot;</span> <span class="na">y=</span><span class="s">&quot;0px&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;path</span> <span class="na">d=</span><span class="s">&quot;M133.7-2.2l157.1,368V792&quot;</span> <span class="na">fill=</span><span class="s">&quot;none&quot;</span>    <span class="na">id=</span><span class="s">&quot;line&quot;</span> <span class="na">stroke=</span><span class="s">&quot;#E11837&quot;</span> <span class="na">stroke-miterlimit=</span><span class="s">&quot;10&quot;</span> <span class="na">stroke-width=</span><span class="s">&quot;2&quot;</span> <span class="nt">&gt;&lt;/path&gt;</span>
</span><span class='line'><span class="nt">&lt;/svg&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can easily get the length of the path using a <a href="https://developer.mozilla.org/en-US/docs/Web/API/SVGPathElement">path method</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span><span class='line'><span class="c1">//826.331</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create a dash the length of the SVG</h2>

<p>With the length of the path calculated, make dash on the path that is the exact same lenght.
This will make the path invisible:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">path</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Set a start point and an end point relative to the top and bottom of the SVG</h2>

<p>The next step is where it gets a little tricky.
There needs to be a starting and a stopping point on the screen to trigger the beginning (or end) of the animation.
This will be determined by calculating the distance of the start point from the top of the page.
To determine this, I used the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRec://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect">getBoundClinetRect method</a>.
This works on any html element and returns a nice object giving the location of the element&rsquo;s bounds <em>relative to the viewPort</em>.</p>

<p>The result looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">path</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">bottom</span><span class="o">:</span> <span class="mf">2455.22607421875</span>
</span><span class='line'>    <span class="nx">height</span><span class="o">:</span> <span class="mf">1816.79736328125</span>
</span><span class='line'>    <span class="nx">left</span><span class="o">:</span> <span class="mf">215.84967041015625</span>
</span><span class='line'>    <span class="nx">right</span><span class="o">:</span> <span class="mf">575.228759765625</span>
</span><span class='line'>    <span class="nx">top</span><span class="o">:</span> <span class="mf">638.4287109375</span>
</span><span class='line'>    <span class="nx">width</span><span class="o">:</span> <span class="mf">359.3790893554687</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>From that we need to find the absolute position.
To do that, get the top position of the body tag.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
</span><span class='line'><span class="c1">//-427</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since this is relative to the view port, it will almost certainly be a negative number.
To get the start point relative to the top of the body, just subtract the top of the body from the top of the element.
From above, this would be 638 - -427. So the start of the element is 1065 pixels from the top of the page.
Now this will all be fine except for that would start the animation when the top of the element is at the top of the viewPort.
The result is that the animation would always be just barely out of view.
That is less than ideal and wouldn&rsquo;t create the desired effect.</p>

<p>The last step is subtracting the distance from the top of the viewPort that we want the effect to start resulting in a start point start point <em>above</em> the top of the SVG.
In other words, if an SVG starts 1000px from the top of the body and the viewport is 100px high (why not) and we want it to start when the top of the SVG is in the middle of the viewport, then the animation <em>really</em> needs to start 950px from the top of the body.
The ability to set the start and stopping point is one of the best ways to control the speed and visual affect of an SVG.
If we want the SVG to coming shooting out of the top of the screen, we can set it to start after the page has past it&rsquo;s starting point (make it a negative number, -2).
If we want the SVG to begin before we hit a visible area, all we need to do is set the start number higher than 1 (1.2) for example.</p>

<p>The end point is pretty much the same, except we get the bottom of the SVG bounding container. Everything else is the same.</p>

<h2>Calculate the distance between the top and the bottom</h2>

<p>With the start and the end points set, the distance is a simple subtraction.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, we need to be able to recalculate this on the fly.
So we really need to know both the total distance and  the remaining distance.
This can be figured out using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollY">window.pageYOffset/window.scrollY</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span><span class="nx">Defined</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">animate</span> <span class="nx">line</span> <span class="kd">function</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">distanceRemaining</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Calculate the amount of pixels that must be added per pixel of vertical scroll</h2>

<p>With the SVG length and starting and stopping points established, all that&rsquo;s left is to figure out how much to add reveal as the user scrolls down.
That is easily accomplished with a simple function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span> <span class="nx">Add</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">prototype</span>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pixelsPerVerticalScroll</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">verticalDistance</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Attach an method to the scroll event that adds pixels (removes the dash)</h2>

<p>Finally, we just need to attach a method to the scroll event so that the line will be continually updated.
It&rsquo;s going to have three parts:</p>

<ol>
<li>If we are before the start point: Show nothing.</li>
<li>If we are after the end poing: Show everything.</li>
<li>If we are between the start and the end point: Show the correct percentage.</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">\\</span> <span class="nx">Attach</span> <span class="nx">the</span> <span class="nx">scroll</span> <span class="nx">even</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">init</span> <span class="kd">function</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Scroller</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">animateLine</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentVisiblePosition</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">distanceRemaining</span><span class="p">()</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">pixelsPerVerticalScroll</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Initializing</h2>

<p>The initialization will set most of the values:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">Scroller</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">el</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//Animation will end when the end is at which point of othe page. .9 is at about 90% down the page/</span>
</span><span class='line'>  <span class="c1">// .1 is 10% from the top of the page. Default is middle of the page.</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">startPoint</span> <span class="o">||</span> <span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">endPoint</span> <span class="o">||</span> <span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animationBounds</span><span class="p">.</span><span class="nx">containerBounds</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPagePosition</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPagePosition</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">svgLength</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">animateLine</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>From there, we can easily add as many as we want. All we need is an ID on the SVG</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">new</span> <span class="nx">Scroller</span><span class="p">({</span>
</span><span class='line'>  <span class="s1">&#39;el&#39;</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;mySvg&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="s1">&#39;startPoint&#39;</span><span class="o">:</span> <span class="nx">startPoint</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;endPoint&#39;</span><span class="o">:</span> <span class="nx">endPoint</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>There were a few other ideas I played with. I considered adding a stop and start to a container element rather than the SVG itself.
This wouldn&rsquo;t be too hard, the only change would be to specify the startPoint and endPoint belong to a different element.
I also considered adding a pause point, but that required too many extra considerations that would depend on screen width and such.
For now, I left it simple and it worked out very well.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-03T16:49:04-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/19/refactoring-$scope-from-angular-projects/">
		
			Refactoring $scope From Angular Projects</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve recently become convinced that Angular code can be significantly improved by eliminating the use of $scope and ng-controller. I started exploring this after a few coders I respect <a href="http://teropa.info/blog/2014/10/24/how-ive-improved-my-angular-apps-by-banning-ng-controller.html">banned ng-controller from their own code</a>.
 I&rsquo;ve found the process to be very helpful for a few reasons. First, it will make the inevitable transition to Angular2 easier as they get rid of both ng-controller and $scope, but, even more importantly, it makes better code right now. And, as a bonus, it makes code look more like <em>gasp</em> real javascript and not Angular&trade; code.</p>

<p>I won&rsquo;t go into the reasons why this makes for better code. I think the above article by <a href="http://teropa.info/blog/2014/10/24/how-ive-improved-my-angular-apps-by-banning-ng-controller.html">Tero Parviainen</a> and another by <a href="http://toddmotto.com/digging-into-angulars-controller-as-syntax/">Todd Motto</a> do a far better than I ever code of explaining the advantages.</p>

<p>Instead I&rsquo;ll just point out that code written in this style:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Something</span><span class="p">.</span><span class="nx">prototype</span>
</span></code></pre></td></tr></table></div></figure>


<p>looks much better than Angular&trade; code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$scope</span><span class="p">.</span><span class="nx">asdf</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m a big believer that good code is also visually aesthetically appealing, so after rewiring some of my brain, I was hooked. The problem is old code. Now it looks bad and even a little embarrassing. Now part of this I attribute to the old adage that you should always be a little embarrassed by old code:</p>

<blockquote class="twitter-tweet" lang="en"><p>&quot;If I&#39;m not embarrassed by the code I&#39;ve written a year ago, I&#39;m not learning enough&quot; great, humble insights from <a href="https://twitter.com/helenhousandi">@helenhousandi</a> <a href="https://twitter.com/hashtag/wceu?src=hash">#wceu</a></p>&mdash; WordCamp Europe (@WCEurope) <a href="https://twitter.com/WCEurope/status/515867304283111424">September 27, 2014</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>However, embarrassment aside, when I have to add some new features it is often worth a short refactor to update to best practices. With that in mind, I kept track of my steps and have developed a simple pattern for updating Angular code to remove reliance on $scope.</p>

<h2>Pattern For Banning $scope</h2>

<p>Here&rsquo;s a pretty typical bit of code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$scope&#39;</span><span class="p">,</span> <span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">util</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_width</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_length</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dimension</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">[</span><span class="nx">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">[</span><span class="nx">dimension</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">get_width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">get_length</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}])</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">&#39;test&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;SomeController&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Hi<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;double_size(&#39;length&#39;)&quot;</span><span class="nt">&gt;</span>Length<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{length}}
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;double_size(&#39;width&#39;)&quot;</span><span class="nt">&gt;</span>Width<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{width}}
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The steps to refactor are pretty simple, but with complex existing code even a little guidance is nice:</p>

<ol>
<li>Create controller function</li>
<li>Locally scope dependency injections</li>
<li>Move $scope functions to prototype methods</li>
<li>Update Template</li>
</ol>


<h2>Create Controller Function</h2>

<p>The first step is to simply make a new controller function.</p>

<p>So this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$scope&#39;</span><span class="p">,</span> <span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">util</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_width</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_length</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dimension</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$scope</span><span class="p">[</span><span class="nx">dimension</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">[</span><span class="nx">dimension</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Becomes this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="nx">SomeControllerFunc</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">SomeControllerFunc</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Already it&rsquo;s starting to look more like actual javascript code and not angular code.</p>

<h2>Locally scope dependency injections</h2>

<p>Dependency injections are a little stranger when a controller is a separate function.
Instead injecting them into the controller, they have to be manually injected with the <code>$inject</code> method.
Fortunately, it makes it a little easier to read since everything is nice and isolated.
Instead of injecting them into the controller declaration, we use the $inject method to add them to the controller function and then add them as an argument to the new controller function.
Note, the argument in the controller does not need to be the same as the service name (or whatever);</p>

<p>I&rsquo;ll also take this opportunity to clean up the service a little bit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="nx">SomeControllerFunc</span><span class="p">);</span>
</span><span class='line'><span class="nx">SomeControllerFunc</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;utilService&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">SomeControllerFunc</span><span class="p">(</span><span class="nx">util</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_width</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_lenght</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">get_width</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">get_length</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;utilService&#39;</span><span class="p">,</span> <span class="nx">utilService</span><span class="p">);</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">utilService</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">utilService</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get_width</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">utilService</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get_length</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Move $scope functions to protoype methods</h2>

<p>Following the refactor of the service now we just need to add the function to the prototype instead of as part of the object.
This is not strictly necessary, but adding functions to the prototype instead of the object is more efficient since new object instances will not need to recopy the method, but will just use the method on the prototype.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="nx">SomeControllerFunc</span><span class="p">);</span>
</span><span class='line'><span class="nx">SomeControllerFunc</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;utilService&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">SomeControllerFunc</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>becomes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SomeController&#39;</span><span class="p">,</span> <span class="nx">SomeControllerFunc</span><span class="p">);</span>
</span><span class='line'><span class="nx">SomeControllerFunc</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;utilService&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">SomeControllerFunc</span><span class="p">(</span><span class="nx">util</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_width</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">get_lenght</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">SomeControllerFunc</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">double_size</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">measurement</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">[</span><span class="nx">measurement</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">measurement</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Easy enough. Again, the best part is the code is looking more and more like standard javascript which is a bonus.</p>

<h2>Update Template</h2>

<p>The last part is easiest. Just change the controller to controller as and update with the correct namespace.</p>

<p>Before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">&#39;test&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;SomeController&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Hi<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;double_size(&#39;length&#39;)&quot;</span><span class="nt">&gt;</span>Length<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{length}}
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;double_size(&#39;width&#39;)&quot;</span><span class="nt">&gt;</span>Width<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{width}}
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">&#39;test&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;SomeController as rectangle&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Hi<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;rectangle.double_size(&#39;length&#39;)&quot;</span><span class="nt">&gt;</span>Length<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{rectangle.length}}
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2</span> <span class="na">ng-click=</span><span class="s">&quot;rectangle.double_size(&#39;width&#39;)&quot;</span><span class="nt">&gt;</span>Width<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>       {{rectangle.width}}
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s a <a href="http://codepen.io/jsmapr1/pen/zGYvdj">code pen</a> if you want to try yourselfk</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-19T11:52:43-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/angular/'>angular</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/05/13/php-unit-mocks/">
		
			PHP Unit Mocks</a>
	</h2>
	<div class="entry-content">
		<p>I recently had to do some development with a third party api.
We&rsquo;ve worked with several apis in the past and they&rsquo;ve always been a huge hassle and, more importantly, we&rsquo;ve never bothered to test code so we can isolate problems should there be a change by the api provider (we are always the last to be notified).</p>

<h2>PHP Unit Mocks</h2>

<p>The best way to test an api is to set up a mock so we can test our api code against the expected return value (the json or xml or whatever).
Fortunately, PHP Unit <a href="https://phpunit.de/manual/current/en/test-doubles.html">has built in mocks</a>.</p>

<p>Working with other apis, we&rsquo;ve abstracted method calls behind a common interface.
In other words, we want to be able to say <code>$api-&gt;getData();</code> and not have to worry about which api we are using or which methods the api is calling.
We just want the data back in a clear, standard way.</p>

<p>Essentially, it looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SomeThirdParty</span><span class="p">(</span><span class="nv">$configs</span><span class="p">);</span>
</span><span class='line'><span class="nv">$widgets</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
</span><span class='line'><span class="c1">//array of standard group of Widget objects built from the data of any api</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the test, we want to do something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">SomeProviderTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetData</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SomeThirdParty</span><span class="p">();</span>
</span><span class='line'>        <span class="c1">//getData calls fetchData internally</span>
</span><span class='line'>        <span class="nv">$widgets</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$widget</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$widget</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nv">$widget</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&rsquo;s some example code (assume a Soap client):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">SomeThirdPary</span> <span class="k">extends</span> <span class="nx">ApiBase</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//Something something connect to api.</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">fetchData</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SoapClient</span><span class="p">(</span><span class="s2">&quot;https://coolapp.com&quot;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;soap_version&#39;</span> <span class="o">=&gt;</span> <span class="nx">SOAP_1_2</span><span class="p">,));</span>
</span><span class='line'>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getWidgets</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="s1">&#39;user&#39;</span>      <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span>
</span><span class='line'>            <span class="s1">&#39;apiKey&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">config</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="p">))</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">SimpleXMLElement</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">function</span> <span class="nf">getData</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$widgets</span> <span class="o">=</span>  <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$allWidgets</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fetchData</span><span class="p">();</span>
</span><span class='line'>        <span class="k">foreach</span><span class="p">(</span><span class="nv">$allWidgets</span> <span class="k">as</span> <span class="nv">$widget</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$w</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Widget</span><span class="p">(</span><span class="nv">$widget</span><span class="p">)</span>
</span><span class='line'>            <span class="c1">//Probablly do some more stuff</span>
</span><span class='line'>            <span class="nv">$widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$w</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$widgets</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The challenge is to mock the response which, in this case, will be an XML element.
Remember, we want to be as close to reality as possible without actually making a live api call.</p>

<p>In the above example, we need to mock out the fetchData method or else a the code will actually try and connect to the api.
And if that happens, beyond being ineffiencent, we won&rsquo;t be able to predict the return results.</p>

<p>Mocks to the rescue!</p>

<p>With mocks, we can set which methods we know will be called and then stipulate a return value.
We don&rsquo;t want to mock all methods; doing so would keep the code from being executed thus rendering the test useless.
The only important method is the api method.</p>

<p>The syntax is pretty straightforward:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="s1">&#39;MockedClass&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//We only want to mock the fetchData method. Because we want getData to execute</span>
</span><span class='line'>        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fetchData&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//Set the return</span>
</span><span class='line'>        <span class="nv">$mock</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
</span><span class='line'>             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">new</span> <span class="nx">\SimpleXMLElement</span><span class="p">(</span><span class="nv">$widgetXML</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Alright, let&rsquo;s try it with the code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">SomeProviderTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGetData</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$provider</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="s1">&#39;SomeThirdParty&#39;</span><span class="p">)</span>
</span><span class='line'>                     <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;fetchData&#39;</span><span class="p">))</span>
</span><span class='line'>                     <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$widgetXML</span> <span class="o">=</span> <span class="o">&lt;&lt;&lt;</span><span class="nx">EOT</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">Widget</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">Widget</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Id</span><span class="o">&gt;</span><span class="mi">54</span><span class="o">&lt;/</span><span class="nx">Id</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Price</span><span class="o">&gt;</span><span class="mf">34.00</span><span class="o">&lt;/</span><span class="nx">Price</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Length</span><span class="o">&gt;</span><span class="mf">5.00</span><span class="o">&lt;/</span><span class="nx">Length</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Width</span><span class="o">&gt;</span><span class="mf">5.00</span><span class="o">&lt;/</span><span class="nx">Width</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="nx">Widget</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">Widget</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Id</span><span class="o">&gt;</span><span class="mi">87</span><span class="o">&lt;/</span><span class="nx">Id</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Price</span><span class="o">&gt;</span><span class="mf">42.00</span><span class="o">&lt;/</span><span class="nx">Price</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Length</span><span class="o">&gt;</span><span class="mf">10.00</span><span class="o">&lt;/</span><span class="nx">Length</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">Width</span><span class="o">&gt;</span><span class="mf">5.00</span><span class="o">&lt;/</span><span class="nx">Width</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="nx">Widget</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="nx">Widgets</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">EOT</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
</span><span class='line'>             <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;fetchData&#39;</span><span class="p">)</span>
</span><span class='line'>              <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">new</span> <span class="nx">\SimpleXMLElement</span><span class="p">(</span><span class="nv">$widgetXML</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//getData calls fetchData internally. We never need to call it.</span>
</span><span class='line'>        <span class="nv">$widgets</span> <span class="o">=</span> <span class="nv">$provider</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$widget</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$widget</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//For now, we&#39;ll just check price. Probably need ot check other things.</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mf">34.00</span><span class="p">,</span> <span class="nv">$widget</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That all there is to it. Now this test will make sure that getData is accurately calling a method, pulling in the data, and performing whatever needs to be done to get the data usable.
In the future if we need change the getData method (maybe get an inventory count for each widget), this test will ensure that a the api will still be called and a price set.
In addition, if getData eventually needs to make more api calls &ndash; for example, maybe it pulls discounts with another method &ndash; we can add those and mock them out in the same way.
Regardless, the test now closely matches the reality the code will experience which will give future developers the security they need to make changes and update code.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-05-13T16:32:53-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/php/'>php</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/04/18/interviews-are-about-the-future-not-the-past/">
		
			Interviews Are About the Future Not the Past</a>
	</h2>
	<div class="entry-content">
		<h2>Most Interviews Are Horrible</h2>

<p>It&rsquo;s almost a clich to point out how a lot of common business practices are carried on out of sense of familiarity or tradition without any thought about what they are trying to accomplish</p>

<p>Job interviews are one of the worst.</p>

<p>I&rsquo;ve interviewed many people and have been interviewed many times to the point that the pattern is so easy I could repeat it in my sleep:</p>

<p><em>Interviewer</em>: How long have you performed <strong>[job x]</strong>?</p>

<p><em>Candidate</em>: I have performed <strong>[job x]</strong> for <strong>[time]</strong>.</p>

<p><em>Interviewer</em>: We are often busy. If you were in <strong>[a challenging situation]</strong>, how would you respond?</p>

<p><em>Candiate</em>: I would respond in a <strong>[very appropriate way]</strong>. When I&rsquo;m around, all situations will be handled <strong>[appropriately]</strong>.</p>

<p>Most interviews proceed this way. Good candidates, or at least candidates that have experience, know a few tricks. Tell stories. Relate the answer to the company and so on. They spend all the time on a few past issues or generic situations where there is clearly a right answer (or stupid &lsquo;interview&rsquo; questions like what are your 3 weaknesses) and move on after a simple answer.</p>

<p>When I ran a department I decided that was a waste of time. My positions were entry level, so most people would not have relevant experiences, so instead I focused on how they handled problems. I figured the way a person approaches a problem is far more important than the problem itself or even the result.</p>

<p>Over time, I developed that philosophy that <em>interviews are about the future, not the past</em>. So I don&rsquo;t settle for simple answers, but instead dig into the candidates reasoning and process.</p>

<h2>Discovering Traits in Applicants</h2>

<p>Interviews too often focus on the past. Maybe this makes sense with certain professions where the problems occur over and over again.
And there is certainly a lot of value to past experiences.
However, that value will only manifest itself if the candidate is reflective and uses the experience to inform their future actions.
There&rsquo;s an old saying in programming about how some people have 10 years of experience and some have 1 year of experience ten times.</p>

<p>The challenge, then, is not just to learn about the experience an applicant has had (presumably a lot of this is evident from their resume and code samples), but to figure out what they did with that experience.</p>

<h3>Concrete Examples</h3>

<p>The best way to determine history is to ask for examples. Instead of asking how they would help a new developer learn a system. Ask &ldquo;Tell me a time when you mentored a new developer even informally.&rdquo; Sure people can inflate their experience, or answer in a self serving way (it is an interview after all) or even lie, but the chance of getting the truth is much higher.</p>

<p>This seems easy enough. Yet people are surprisingly reluctant to be concrete. I was in an interview with a potential engineering manager and I asked for a time when he resolved a conflict between management needs (getting a product out quickly) and engineering needs (having well-tested, well crafted code).</p>

<p>He responded &ldquo;Yes, I&rsquo;ve had situations like that. I usually try to talk with both parties&hellip;&rdquo;
After he finished, I said that was great, but I wanted a concrete example.
He started talking again using a concrete situation for a moment, but then going abstract.
I gave up on him.</p>

<p>Why are concrete examples so important?
It&rsquo;s because life is messy. In hypothetical scenarios we all get both sides to agree, we all convince the under-performing employee to buck up, and we all tweak the process to get products out on time.
In real life, one or both sides loses something, people are grumpy when given criticism and process changes often lead to slower turnaround.
Every decision has choices, trade offs, and consequences.
That&rsquo;s what I want to know about.
We can solve the imaginary problems when we reflect on how we will do it differently in the future.</p>

<h3>Pry</h3>

<p>The most common question I ask in interviews is &ldquo;why&rdquo; and the second most common is &ldquo;what did you learn from that.&rdquo;
Any answer to an interview question is, at best, a surface summary.
To take the previous example, if a candidate answered they mentored a new developer by giving them an easy project and then checking the code after it was finished, I would say &ldquo;why did you wait until they were finished?&rdquo;.
Maybe the candidate would say they were busy and this was the only time that they had.
Maybe they would say they think working through a problem through the end teaches independence and problem solving.
Maybe it was because they gave them a really small problem and would give harder and harder problems moving forward.
I don&rsquo;t know.
The problem is we don&rsquo;t ask.</p>

<p>The secret to understanding a candidate is to understand their motivations and their process.
We spend so much time on a candidates history, but history is fairly unimportant.
To repeat, when we hire someone, we are hiring their future.
Instead of spending time on the problems they solved, we need to understand how they solved them and why.
The second most common question I ask is &ldquo;what did you learn from that&rdquo;.
When candidates reflect back on their experience, they inadvertently highlight the priorities in their career.
If a candidate built a new UI for their product, I may ask what they learned from the process.
They may talk about how changing requirements caused them to modify how they worked with other departments on new issues or maybe they learned some technical trick or skill that they applied later.
Every project is imperfect and every insight will color all future tasks.</p>

<h3>Pain Points</h3>

<p>The last thing I always try to do is find out how candidates deal with adversity.
For managers, I often ask what&rsquo;s the hardest decision they&rsquo;ve had to make.
For everyone including non-managers, I ask for an idea or project they tried to implement that did not work out.
I don&rsquo;t believe in the strange Silicon Valley habit of <a href="http://nymag.com/daily/intelligencer/2014/03/silicon-valley-failure-fetish.html">fetishizing failure</a>, but no one has a perfect track record and I want to know how they dealt with problems.</p>

<p>Here&rsquo;s the secret.
Saying, &ldquo;I decided it wasn&rsquo;t worth pursuing&rdquo; is an acceptable answer (provided they explain why they reached that decision).
In fact, the worst thing I can hear is someone being over aggressive in pushing through their agenda.
There&rsquo;s a whole post I can write about how people confuse being an asshole for being confident or assertive, but for now I will just say that pushing through a solution that destroys a team, department, or company is a horrible decision.
My favorite answer is when a candidate talks about how they realized a plan wasn&rsquo;t going to work, so they reassessed the situation and tried again.</p>

<h2>Filling a Niche</h2>

<p>After all this, a pretty good image of the candidate should emerge.
Many will seem confused by the process (particularly after the third &ldquo;why&rdquo;), but it so much easier to understand how someone will fit into an existing group after this is all finished.
The hard part is deciding if they are a good fit.
I&rsquo;m not talking about a fit in the sense of whether they will be fun to have lunch with, but whether they will fit the niche of the team.
Good teams are like ecosystems, they need diversity.
A candidate that is a perfectionist about code quality may be a good fit on a team that needs someone to keep them honest, but may be a horrible fit on a team that has great code, but can&rsquo;t meet deadlines.
Sometimes the hardest part is trying to figure out which niche needs to be filled.
The questions should be built to decide if a candidate will fit that role.</p>

<p>In one of my previous positions, I was hiring my replacement at a university water ecology department.
I had set up a digital repository for publication produced the department, so the technical challenge was all but completed.
The real challenge at that point was gaining buy-in to the system and training people how to use it and convincing them that they would benefit by using it.
In this case, many of my questions revolved around developing training and working with a range of individuals.
The best person ended up being a former science teacher.
She had both the science background to gain trust for the members of the department and had experience, well, teaching.
She had led projects that met with skepticism from her peers and she learned from that skepticism how best to sell ideas to colleagues.</p>

<p>I wasn&rsquo;t surprised when she led several well attended seminars on the system.
I knew she would do something to integrate the system into the work flow of the staff.
I merely had no idea how she would do that, but I knew she&rsquo;d find a way and that was all that mattered.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-04-18T14:12:45-05:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/leadership/'>leadership</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/03/17/what-makes-a-good-development-team/">
		
			What Makes a Good Development Team</a>
	</h2>
	<div class="entry-content">
		<p>The best interview question I was ever asked was so perplexing in its simplicity. It was <em>What Makes a Good Development Team</em>?</p>

<p>What made it interesting is that when engineering positions are advertised, there are always lists of technical qualifications. And most position descriptions pay homage to the question of &ldquo;What Makes a Good Development Team&rdquo; with a throw away line about &ldquo;fit&rdquo; or something like that. However, crafting a good team may be one of the most important parts of creating a successful project.</p>

<h2>Technical</h2>

<p>My answer was divided into the technical needs and the personality traits. As for technical needs, there needs to be a mix. There needs to be people with highly developed skills and those with skills that are not as highly developed. We all understand this intuitively. There are difficult problems that require a lot of knowledge and experience, but there are lot and lots and lots of small problems that do not necessarily need a PhD to solve them.</p>

<p>However, the mix shouldn&rsquo;t be just of skill levels, it also needs to be a mix of goals. A good team needs beginning developers that want to be senior developers and it needs senior developers that want to be leads or managers, but it also needs a mix of people that like their position and do not necessarily want to change. Why? Because there needs to be a line of continuity and also a path of succession.</p>

<p>If new people aren&rsquo;t challenged, they are going to leave. If senior devs do boring work, they are going to leave. Even if that is taken care of, though, people will still leave. That&rsquo;s what people do. Teams that are mixed can fill in the gaps easily. A junior developer can step up. Small, but necessary problems can be spread out and eventually a new hire will happen or people will shift around until a balance is maintained.</p>

<p>That was all pretty uncontroversial, I&rsquo;m sure. However, I&rsquo;ve seen cases where new devs are treated as if they never want to move up. No challenges are presented. They don&rsquo;t get to understand the whole system and then when a senior disappears, there is panic. Usually management will go to recruiters and hire expensive senior devs who have overhead in learning the system when there should&rsquo;ve been a plan from the start. It&rsquo;s good to bring in senior devs from the outside and organizations that rely exclusively on internal promotions (either because of policy or because of convention) will suffer, but they should never be hired out of desperation.</p>

<h2>Personality</h2>

<p>The second part of what makes a good dev team is harder to pin down. We all know we don&rsquo;t want to work with jerks. And we all know that there is this elusive quality called &ldquo;fit&rdquo; that everyone talks about, but no one defines. Well, what is fit?</p>

<h3>Empathy</h3>

<p>If I could sum up the single most important personality trait an engineer should have, it&rsquo;s empathy (which I would argue is the most important trait for all people to have). Why is empathy important? Empathy is what makes individuals a team. When individuals empathize with each other, they are able to create a set of shared goals. They are able to understand how code will effect others on the project. They are able to think how a user will interact with the system.</p>

<p>There is a stereotype of the grumpy programmer. They are cranky, hate to be disturbed, will complain about every UI tweak or change, but are somehow geniuses that can solve any problem. They are not worth the time. I personally hate that stereotype, because it conflates two character traits that have nothing in common: logical ability and lack of empathy.</p>

<p>My current team, has been working on a large project for months. It&rsquo;s going to define the future of our product, so it&rsquo;s a pretty big deal. During that time we&rsquo;ve had an important team member leave and we&rsquo;ve acquired new clients with their own problems. This means that even though there is a this giant looming deadline, we&rsquo;ve all had to shift in our roles. I&rsquo;ve had to finish client facing websites that another developer started and I&rsquo;ve had to shelve a major project that I&rsquo;m completing (a project that I loved working on) because I needed to offer support to the engineers working on the bigger project. Another developer had to take over managing the project which meant his responsibilities shifted to another engineer who had to deal with an increased workload. The only way this works is because we all understand we are trying to do our best work as a group. Any single individual can complain about their role, but doing so wouldn&rsquo;t advance us towards the goal. Empathy for teammates, for clients, for individuals throughout the company keep things moving forward.</p>

<h3>Tenacity</h3>

<p>The other trait that individuals need to make a good team is tenacity. They need to be able to persevere and have drive to complete projects and launch big ideas. There are a lot of mundane programming tasks, but there are many more difficult tasks that are, at best, partially solved. Programming is a creative act and carries with it a certain amount of frustration and confusion.</p>

<p>For most programmers, that is the point. They want the challenge. It are these programmers that make a good team. A good team not only is undeterred by difficult problems, they are invigorated by them.</p>

<h2>Great Teams Make Great Things</h2>

<p>A CEO I know said that the most expensive problems are always human problems. Development teams tend to take on the personalities and skills of their members. If balance is not maintained people leave or fight or create divisions that can persist long after the original instigators are gone. A well balanced development team will make a great product. A poorly formed team will just create problems.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-03-17T11:17:22-05:00" pubdate data-updated="true"></time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/02/20/testing-angular-ui/">
		
			Testing Angular UI Modals</a>
	</h2>
	<div class="entry-content">
		<p>I recently ran into an issue while testing an modal using <a href="http://angular-ui.github.io/bootstrap/">Angular UI Bootstrap</a>. My goal was to create a directive that will trigger a modal to open when clicked. The directive code is relatively simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;modalTrigger&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$modal&#39;</span><span class="p">,</span> <span class="s1">&#39;sharedData&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$modal</span><span class="p">,</span> <span class="nx">sharedData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">scope</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">submitUrl</span> <span class="o">:</span> <span class="s1">&#39;@&#39;</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nx">link</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">elem</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">$modal</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
</span><span class='line'>                    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;&lt;div another-directive&gt;&lt;/div&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;AwesomeController as ac&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="nx">resolve</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nx">submitUrl</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">return</span> <span class="nx">scope</span><span class="p">.</span><span class="nx">submitUrl</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">})</span>
</span><span class='line'>                    <span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                        <span class="c1">//Something on close</span>
</span><span class='line'>                    <span class="p">},</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                        <span class="c1">//Something on dismiss</span>
</span><span class='line'>                    <span class="p">})</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>The idea is to be able to set any element to trigger a modal (which grabs some content via ajax, but that&rsquo;s a different issue):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;button</span> <span class="na">modal-trigger</span> <span class="na">submit-url=</span><span class="s">&quot;/somepage&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem I had was in testing the code (with karma and jasmine) was getting the modal to return a result promise.</p>

<p>Here was the original test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Directive: modalTrigger&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">$compile</span><span class="p">,</span> <span class="nx">$modal</span><span class="p">,</span> <span class="nx">fakeModal</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;my-mod&#39;</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_$compile_</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">_$modal_</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$compile</span> <span class="o">=</span> <span class="nx">_$compile_</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">$modal</span> <span class="o">=</span> <span class="nx">_$modal_</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">scope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">$modal</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">element</span> <span class="o">=</span> <span class="s1">&#39;&lt;a modal-trigger ng-app=&quot;some-app&quot; submit-url=&quot;/test&quot;&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">element</span> <span class="o">=</span> <span class="nx">$compile</span><span class="p">(</span><span class="nx">element</span><span class="p">)(</span><span class="nx">scope</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">scope</span><span class="p">.</span><span class="nx">$digest</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}))</span>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;will open a modal when clicked&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$modal</span><span class="p">.</span><span class="nx">open</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toHaveBeenCalled</span><span class="p">()</span>
</span><span class='line'>        <span class="nx">element</span><span class="p">.</span><span class="nx">triggerHandler</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">expect</span><span class="p">(</span><span class="nx">$modal</span><span class="p">.</span><span class="nx">open</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">()</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem is the spy. Originally I didn&rsquo;t use the modal result promise. When I explicitly started using it, the tests started failing. The reason is that when a spy is set in jasmine, it stubs out the object, but does not execute it in the code. The fix is easy, I could either create a fake or I can just tell jasmine to use the actual object that I am spying on.</p>

<p>Here&rsquo;s an example of creating a fake object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">fakeModal</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">result</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">then</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">dismiss</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">type</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="nx">spyOn</span><span class="p">(</span><span class="nx">$modal</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">).</span><span class="nx">andReturn</span><span class="p">(</span><span class="nx">fakeModal</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ultimately I decided to just call through to the actual object since I wasn&rsquo;t testing the promise and didn&rsquo;t need a mock, but I wanted to keep the test as close as possible to the actual code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">spyOn</span><span class="p">(</span><span class="nx">$modal</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">).</span><span class="nx">andCallThrough</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Viola. Now I can test that my directive is actually executing as expected. This is all very simple, but a nice way to isolate test code and to check for a call to a promise (or anything really).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-02-20T11:07:53-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/angular/'>angular</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/01/27/leading-without-authority/">
		
			Leading Without Authority</a>
	</h2>
	<div class="entry-content">
		<p>I have never had one of those positions where people had to do what I say <em>or else</em>! Honestly, I think that has been for the best because with very few exceptions most of us will not have authority over someone we are trying to persuade; we can&rsquo;t tell our boss to do it our way <em>or else</em>. Even in cases where we do have authority over a person or a group of people, the moment we start invoking that authority as a means of changed, we have already failed. It may work in the short term, but it will seldom work in the long term.</p>

<p>This is my experience of leading without authority. I figured out most of this by leading student organizations in college and later by working in academic settings where the hierarchy is rather rigid. I think the most difficult part of any form of leadership without authority is to have patience. It&rsquo;s easy to propose an idea, get in a huge argument, cause an uproar, and then sulk away feeling resentful. In fact, I think a lot of people prefer that to the hard work of negotiating change. However, this will fail to bring about meaningful change.</p>

<h3>What Can I Do?</h3>

<p>The best way to implement change is to understand that it is a process, not a single moment. If a proposal is being made to a room full of people for the first time, it is doomed to fail. Humans are generally conservative when approached with change and, for the most part, that is good. Organizations that are not at least a little conservative have a hard time remaining focused.</p>

<p>With that said, I think the key to leading without authority comes down to three things: <strong>communication</strong>, <strong>time</strong>, and <strong>focus</strong>. Here&rsquo;s a brief summary of what those mean:</p>

<ul>
<li><p><strong>Communication</strong> : Getting buy-in by talking with individuals or groups as often as necessary before an official proposal is made.</p></li>
<li><p><strong>Time</strong>: Waiting until the correct opportunity arises. In other words, not trying to make a change when there are clearly other more pressing priorities or before there has been ample buy-in.</p></li>
<li><p><strong>Focus</strong>:Keeping a project moving ahead, albeit slowly, and keeping the discussion moving towards implementation instead of delay. Probably the most underutilized tool, but the most important.</p></li>
</ul>


<h3>Communication</h3>

<p>Barring some odd circumstances, we all have the ability to talk (or email, or chat, or send passenger pigeons) and the root of all else is using this ability. It seems over simple, but too often people hoard their communication like a limited resource and then expect all other people to follow them the second the make a suggestion or proposal. I got a piece of advice early in my career that I think back to constantly: <em>Never make a proposal in a meeting unless you are sure it will pass</em>. In fact, I found this piece of advice so good that during a panel on leading in libraries I made the statement that &ldquo;being in meetings is a skill that must be developed&rdquo;. The whole room had the chance to laugh at me, but I stand by what I said. Good leaders can predict the outcome or wait until they can.</p>

<p>Here&rsquo;s a practical example: I had a time where I ran a small library in an academic department. While there, I noticed that the library was full. Seriously. There was no space on the shelves. Not only that, but there were significant portions of the collection that had nothing to do with the department. People where just cleaning out their offices and houses and dumping them there. Well, I proposed cleaning it out in a meeting and everyone there, every single person, decided it was a bad idea and said no. It blew my mind. It was so clearly a problem.</p>

<p>Well, I was young, naive and thought the people would listen to good ideas. Before the next meeting I put together a few charts showing total space, space used, potential space savings &ndash; I should note I worked with scientists, so they loved the charts &ndash; and then I spent the next weeks randomly stopping all the members in the hall and casually mentioning the issue and one or two examples of what we could remove (a book on caring for your pet goldfish &hellip; from 1970). Sure enough, next time everyone agreed the issue needed to be addressed.</p>

<p>Every proposal I made since then has followed the same approach. No, charts are not always necessary, but having a variety of data is important. Some people like numbers. Some people like anecdotes. Some people like visuals. Be prepared for them all and only use those that are necessary (people can also sniff out overeagerness which triggers defenses).</p>

<p>An important corollary to this is to always catch relationship problems early. When building support it&rsquo;s important to ensure that even those that are skeptical of a proposal feel they are included in the discussion. The absolute worst thing that can happen is for the issue to turn into a me vs. you or us vs. them situation. Disagreements are bound to happen and there will almost certainly be people that will not be convinced. That&rsquo;s ok, but try to ensure the disagreement is over the idea and does not become a personal conflict. Tribal resistance is far more difficult to handle than differences based on evidence or prioritizations.</p>

<h3>Time</h3>

<p>If there was a single difference between leading with authority and leading without authority, it is the role of time. In short, those with authority have the ability to move much faster. Even if they are not leading by fiat (I&rsquo;m in charge, so do it), they can set the agenda with ease, people will be more likely to give them a chance, and so on.</p>

<p>Unlike communication, time is a personal discipline. Effective leaders have patience. Leaders have the patience to wait until the opportunity is right. They have the patience to build support. They have the patience to suppress emotional responses that might feel good, but will certainly torpedo a project. And they have the patience to know when an opportunity has passed and to back off until the time is right to try again.</p>

<p>Time and patience are most important when dealing with resistance or contentious issues. I had one particular meeting on a project I was asked to lead. I decided to meet with a few individuals who were, to put it lightly, not excited about the idea. The meeting was pretty tense. They were very direct and aggressive in questioning, but I set a goal of responding politely, but assertively, listening, but still willing to challenge their ideas and points. They certainly were not persuaded that day, but instead of leaving the room with personal stakes and entrenched positions, it kept the focus on the goals of the project (increased staff participation in training) and not the personalities or solutions.</p>

<p>Time is a difficult thing and people are often very afraid of it. There is a nagging feeling that if an issue is not fixed today, this very day, then there will be chaos. We all know this is crazy, but we all still fall for it. So why is time difficult? If we are not careful, we lose site of the goal and get caught in the implementation of which time is a key part. Conversely, time can be an asset, if one can keep focus on the end goal, then time is an ally that can be used to change minds, build support, and generally create more likelihood of a successful result.</p>

<h3>Focus</h3>

<p><strong>Get Started</strong>: I&rsquo;ve found it&rsquo;s much easier to dismiss ideas in the abstract than it is to dismiss concrete things. Sometime the best way to get support is to show some value. Now this is a tricky place to be. You don&rsquo;t want to be accused of wasting time or ignoring other responsibilities, but you can&rsquo;t exactly request time to work on some unapproved project (that would be missing the whole point).</p>

<p>The cliche is, of course, &ldquo;beg for forgiveness, don&rsquo;t ask for permission&rdquo;. That can be a useful concept, but I always thought it had a negative connotation. Rather, try to get something minimal while always ensuring there is never a disruption to your current workload. It&rsquo;s also ok to mention to your boss or whoever, that you are exploring a side project. For example, after having a quick exchange about something else just say &ldquo;I&rsquo;m also looking a little into {{Foo}}. I think it can have the potential to BIG BENEFIT&rdquo;. Most of the time this will either get dismissed with a &ldquo;yeah sure&rdquo; or you may get a skeptical look, which can be answered with an assurance that this is on the side and will no way impact all the other super important work you are doing.</p>

<p><strong>Keep Focus</strong>: A lot of projects get ignored into non-existence. So, keeping the focus is key to giving life to ideas, especially those ideas that are already on the edge of survival. Now what does this mean? It does not mean bringing it up constantly and annoying everyone. In fact, that is a guaranteed way to create resistance.</p>

<p>Rather keeping focus means always taking responsibility for next steps. Anytime a meeting ends, there should be a list of next steps (action items, if you like that jargon). As is usual, this sounds super easy, but is actually quite hard. Most meetings are ended with an agreement that something is good or something is bad, but almost no forward moving direction. Having a plan of the next steps &ndash; Contact Stakeholders, Write a Proposal, Get Feedback from Another Department &ndash; will keep the project moving forward.</p>

<p>The other side of this is keeping an idea alive. A common way to kill an idea is that it&rsquo;s not the right time. Of course, there is usually never a good time for any idea, but sometimes that true. Maybe someone is out of town, or it&rsquo;s the holiday season. Who knows. A good leader will revive an issue that has started to stagnate. Sometimes its just as easy as touching base with the decision makers or checking in with those that are working on pieces of the project. Sometimes its hard and requires starting nearly from scratch. That&rsquo;s fine. The goal is to make constant progress no matter how small. Eventually, the idea will not seem novel or strange it will seem normal and obvious. After, that it&rsquo;s all about implementation.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-01-27T16:53:43-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/leadership/'>leadership</a>

</div>


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/01/08/protractor-in-iframe/">
		
			Protractor in Iframe</a>
	</h2>
	<div class="entry-content">
		<h1>Working With Iframes in Protractor</h1>

<p>One of the hardest parts of legacy system is finding the confidence to refactor code. It&rsquo;s not a matter of if one will have to refactor code, but rather the question is when and how much.</p>

<p>If you happen to be lucky enough to inherit a well documented and well tested system, then good for you. If only we were all so lucky. Most of us inherit systems that are not so easy, but again, the need to refactor will present itself eventually.</p>

<p>When I started building tests into the system, I did what many do and focused on unit test first. I even wrote tests for some of the more important code (or some of the code that had a bad habit of being broken). However, this didn&rsquo;t help much with refactoring because a lot of the code was tangled spaghetti code that needed to be refactored before tests could even be written. Enter end-to-end testing.</p>

<h1>End to End Tests</h1>

<p>In our particular case, the largest problem is that nearly every feature has customizations for clients. Some customizations are used by only one person and are so obscured by the code that it&rsquo;s hard to notice until it&rsquo;s too late. Previously, we have been bad developers and either checked a sampling of clients by hand (always missing one or two exceptions) or, more likely, relying on QA to check a sampling of clients by hand (still missing at least one edge case).</p>

<p>Hoping to find a better way, we have started using protractor for end-to-end testing. Currently, we have just been using it for refactoring, but eventually we will use it to keep better track of different client specific code alterations. Eventually, as code coverage of unit tests expand this may be less necessary, but for now it serves both as a test and as a form of documentation.</p>

<h1>Use Case</h1>

<p>Protractor is pretty simple and the documentation has been pretty good, so I won&rsquo;t go through the set up and all that. I did however have a problem with capturing information in iframes. The refactoring project is converting modals from jquery-ui, which uses iframes, to angular-ui which uses bootstrap and ajax.</p>

<p>With protractor generally, you just select the xpath and use that to run the test. However, when an iframe is involved, we need to first switch contexts. This is all modified from this <a href="http://stackoverflow.com/questions/20425909/protractor-testing-angular-app-in-an-iframe">great stackoverflow answer.</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;angularjs homepage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prot</span><span class="p">,</span> <span class="nx">driver</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prot</span> <span class="o">=</span> <span class="nx">protractor</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">driver</span> <span class="o">=</span> <span class="nx">prot</span><span class="p">.</span><span class="nx">driver</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">browser</span><span class="p">.</span><span class="nx">ignoreSynchronization</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should open reservation modal&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// First load the client</span>
</span><span class='line'>      <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://someclient.localhost/reserver&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// Then click to open the modal. Don&#39;t care which one, so click the first button.</span>
</span><span class='line'>      <span class="nx">element</span><span class="p">(</span><span class="nx">by</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;.reserve_button&#39;</span><span class="p">)).</span><span class="nx">click</span><span class="p">();</span>
</span><span class='line'>      <span class="c1">// Now, switch to the iframe</span>
</span><span class='line'>      <span class="nx">prot</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">().</span><span class="nx">frame</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">protractor</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@id=&quot;reservation_dialog&quot;]/iframe&#39;</span><span class="p">)));</span>
</span><span class='line'>      <span class="c1">// Then get the element by xpath</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">modal</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">protractor</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="nx">expect</span><span class="p">(</span><span class="nx">modal</span><span class="p">.</span><span class="nx">getText</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="sr">/Reserve Now/</span><span class="p">);</span>
</span><span class='line'>    <span class="p">})})</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s all pretty simple, but not well covered in documentation. So here it is for all eternity.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-01-08T15:12:10-06:00" pubdate data-updated="true"></time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/testing/'>testing</a>

</div>


	
</div></article>

<nav id="pagenavi">
    
        <a href="2" class="prev">Prev</a>
    
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2017

    Joe

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-84697313-1');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



</body>
</html>
